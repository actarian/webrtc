{"version":3,"sources":["src/js/main.js","../../src/js/signaling/signaling.service.js","../../src/js/user-media/user-media.service.js","../../src/js/web-socket/web-socket.service.js","../../src/js/webrtc/webrtc-client.service.js","../../src/js/app.component.js","../../src/js/environment.served.js","../../src/js/utils/utils.js","../../src/js/environment.js","../../src/js/environment.static.js","../../src/js/flag/flag.pipe.js","../../src/js/webrtc/webrtc-stream.component.js","../../src/js/app.module.js","../../src/js/main.js"],"names":["g","f","exports","module","require","define","amd","globalThis","self","rxcomp","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_defineProperty","obj","value","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","SignalingService","in","message","in$","next","out","out$","send","sendBack","assign","clientId","remoteId","broadcast","ReplaySubject","UserMediaService","getUserMedia","Promise","resolve","reject","navigator","mediaDevices","audio","video","width","min","ideal","max","height","then","stream","catch","error","console","log","WebSocketService","connect","uid","onMessageCallback","getUniqueUserId","onOpen","bind","onClose","onMessage","host","location","origin","replace","socket","WebSocket","addEventListener","disconnect","close","event","type","message$","JSON","parse","data","response","backMessage","timeStamp","Date","now","stringify","sendAll","Math","floor","random","toString","CONNECTION_OPTIONS","iceServers","urls","OFFER_OPTIONS","offerToReceiveAudio","offerToReceiveVideo","WebRTCClient","_this","BehaviorSubject","MediaStream","onIceCandidate","onIceConnectionStateChange","onIceGatheringStateChange","onSignalingStateChange","onNegotiationceNeeded","onTrack","connection","RTCPeerConnection","getTracks","forEach","track","addTrack","pipe","filter","subscribe","onMessageCandidate","onMessageAnswer","_proto","dispose","remote$","removeEventListener","candidate","iceConnectionState","iceGatheringState","signalingState","_this2","createOffer","offer","setLocalDescription","_","description","localDescription","x","onCreateOfferReject","remote","streams","sendOffer","_this3","addIceCandidate","onAddIceCandidateReject","onMessageOffer","_this4","RTCSessionDescription","setRemoteDescription","createAnswer","answer","onCreateAnswerReject","all","call","WebRTCClientService","addPeer","peerId","peers","peers$","getValue","slice","reduce","c","client","push","switchRemotes","addPeers","peerIds","removePeer","index","splice","remotes","map","remotes$","combineLatest","of","switchAll","AppComponent","_Component","apply","arguments","onInit","getContext","node","classList","remove","local","tap","onSocketConnected","onJoined","onPeers","onPeerJoined","onPeerLeaved","onOffer","takeUntil","unsubscribe$","pushChanges","onJoin","info","firstName","lastName","remotePeers","indexOf","get","Component","meta","selector","Utils","merge","source","keys","Array","isArray","NODE","BASE_HREF","URLSearchParams","window","search","document","querySelector","getAttribute","HEROKU","STATIC","port","DEVELOPMENT","split","ENV","PRODUCTION","Environment","options","url","language","market","getAbsoluteUrl","path","params","getPath","isLocal","href","set","githubDocs","defaultAppOptions","channelName","flags","production","useProxy","useToken","selfService","guidedTourRequest","editor","ar","menu","attendee","streamer","viewer","smartDevice","maxQuality","heroku","environmentOptions","logo","background","image","colors","menuBackground","menuForeground","menuOverBackground","menuOverForeground","menuBackBackground","menuBackForeground","menuBackOverBackground","menuBackOverForeground","assets","worker","languages","defaultLanguage","fontFamily","disabledViewTypes","disabledViewItemTypes","renderOrder","panorama","model","plane","tile","banner","nav","panel","debug","pointer","environment","bhere","FlagPipe","_Pipe","transform","Pipe","name","WebRTCStreamComponent","muted","onChanges","srcObject","onMuteToggle","inputs","template","AppModule","_Module","Module","imports","CoreModule","declarations","bootstrap","Browser"],"mappings":"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","file":"docs\\js\\main.min.js","sourcesContent":[null,"import { ReplaySubject } from 'rxjs';\r\n\r\nexport class SignalingService {\r\n\r\n\tstatic in$ = new ReplaySubject(1);\r\n\tstatic in(message) {\r\n\t\tSignalingService.in$.next(message);\r\n\t}\r\n\r\n\tstatic out$ = new ReplaySubject(1);\r\n\tstatic out(message) {\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic send(message) {\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic sendBack(message) {\r\n\t\tmessage = Object.assign({}, message, { clientId: message.remoteId, remoteId: message.clientId });\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic broadcast(message) {\r\n\t\tmessage.broadcast = true;\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\r\n}\r\n","\r\nexport class UserMediaService {\r\n\r\n\tstatic stream = null;\r\n\r\n\tstatic getUserMedia() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options = {\r\n\t\t\t\taudio: true,\r\n\t\t\t\tvideo: {\r\n\t\t\t\t\twidth: { min: 320, ideal: 640, max: 640 },\r\n\t\t\t\t\theight: { min: 240, ideal: 480, max: 480 }\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tnavigator.mediaDevices.getUserMedia(options).then((stream) => {\r\n\t\t\t\t// console.log('UserMediaService.getUserMedia', stream);\r\n\t\t\t\tUserMediaService.stream = stream;\r\n\t\t\t\t/*/\r\n\t\t\t\tconst audioTracks = stream.getAudioTracks();\r\n\t\t\t\tif (audioTracks.length > 0) {\r\n\t\t\t\t\tconsole.log('UserMediaService.audioTracks', audioTracks[0].label);\r\n\t\t\t\t}\r\n\t\t\t\tconst videoTracks = stream.getVideoTracks();\r\n\t\t\t\tif (videoTracks.length > 0) {\r\n\t\t\t\t\tconsole.log('UserMediaService.videoTracks', videoTracks[0].label);\r\n\t\t\t\t}\r\n\t\t\t\t/*/\r\n\t\t\t\tresolve(stream);\r\n\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.log('UserMediaService.getUserMedia.error', error);\r\n\t\t\t\treject(error);\r\n\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\n\r\nexport class WebSocketService {\r\n\r\n\tstatic message$ = new ReplaySubject(1);\r\n\r\n\tstatic connect(uid = null, onMessageCallback = null) {\r\n\t\tuid = uid || this.getUniqueUserId();\r\n\t\tthis.uid = uid;\r\n\t\tthis.onMessageCallback = onMessageCallback;\r\n\t\tthis.onOpen = this.onOpen.bind(this);\r\n\t\tthis.onClose = this.onClose.bind(this);\r\n\t\tthis.onMessage = this.onMessage.bind(this);\r\n\t\tconst host = location.origin.replace(/^https/, 'wss').replace(/^http/, 'ws');\r\n\t\tconst socket = this.socket = new WebSocket(host);\r\n\t\tsocket.addEventListener('open', this.onOpen);\r\n\t\tsocket.addEventListener('close', this.onClose);\r\n\t\tsocket.addEventListener('message', this.onMessage);\r\n\t}\r\n\r\n\tstatic disconnect() {\r\n\t\tconst socket = this.socket;\r\n\t\tif (socket) {\r\n\t\t\tsocket.close();\r\n\t\t\tthis.socket = null;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onOpen(event) {\r\n\t\t// console.log('WebSocketService.onOpen');\r\n\t\tconst message = { type: 'socketConnected' };\r\n\t\tthis.message$.next(message);\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onClose(event) {\r\n\t\t// console.log('WebSocketService.onClose');const message = { type: 'socketConnected' };\r\n\t\tconst message = { type: 'socketDisconnected' };\r\n\t\tthis.message$.next(message);\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onMessage(event) {\r\n\t\tconst message = JSON.parse(event.data);\r\n\t\t// console.log('WebSocketService.onMessage', message);\r\n\t\tif (message.remoteId) {\r\n\t\t\tmessage.sendBack = (response = {}) => {\r\n\t\t\t\tconst backMessage = Object.assign({}, message, response, { uid: message.remoteId, remoteId: message.uid });\r\n\t\t\t\tWebSocketService.send(backMessage);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t\tthis.message$.next(message);\r\n\t}\r\n\r\n\tstatic send(message = {}, broadcast) {\r\n\t\tconst socket = WebSocketService.socket;\r\n\t\tmessage.uid = this.uid;\r\n\t\tmessage.timeStamp = Date.now();\r\n\t\tif (broadcast) {\r\n\t\t\tmessage.broadcast = true;\r\n\t\t}\r\n\t\t// console.log('WebSocketService.send', message);\r\n\t\tsocket.send(JSON.stringify(message));\r\n\t}\r\n\r\n\tstatic sendAll(message = {}) {\r\n\t\tWebSocketService.send(message, true);\r\n\t}\r\n\r\n\tstatic getUniqueUserId() {\r\n\t\t// max safe integer 9007199254740991 length 16\r\n\t\t// max allowed integer 4294967296 2^32\r\n\t\tconst m = 9007199254740991;\r\n\t\tconst mult = 10000000000000;\r\n\t\tconst a = (1 + Math.floor(Math.random() * 8)) * 100;\r\n\t\tconst b = (1 + Math.floor(Math.random() * 8)) * 10;\r\n\t\tconst c = (1 + Math.floor(Math.random() * 8)) * 1;\r\n\t\tconst combo = (a + b + c);\r\n\t\tconst date = Date.now();\r\n\t\tconst uid = combo * mult + date;\r\n\t\t// console.log(combo);\r\n\t\t// console.log(date);\r\n\t\t// console.log(m);\r\n\t\t// console.log('AgoraService.getUniqueUserId', uid);\r\n\t\treturn uid.toString();\r\n\t}\r\n\r\n}\r\n","import { BehaviorSubject, combineLatest, of, ReplaySubject } from 'rxjs';\r\nimport { filter, switchAll } from 'rxjs/operators';\r\nimport { SignalingService } from '../signaling/signaling.service';\r\n\r\nconst CONNECTION_OPTIONS = {\r\n\ticeServers: [{\r\n\t\turls: 'stun:stunserver.org'\r\n\t}, {\r\n\t\turls: 'stun:stun.ekiga.net'\r\n\t}, {\r\n\t\turls: 'stun:stun.ideasip.com'\r\n\t}, {\r\n\t\turls: 'stun:stun.iptel.org'\r\n\t}, {\r\n\t\turls: 'stun:stun.rixtelecom.se'\r\n\t}, {\r\n\t\turls: 'stun:stun.schlund.de'\r\n\t}, {\r\n\t\turls: 'stun:stun.softjoys.com'\r\n\t}, {\r\n\t\turls: 'stun:stun.voiparound.com'\r\n\t}, {\r\n\t\turls: 'stun:stun.voipbuster.com'\r\n\t}, {\r\n\t\turls: 'stun:stun.voipstunt.com'\r\n\t}]\r\n};\r\n\r\nconst OFFER_OPTIONS = {\r\n\tofferToReceiveAudio: true,\r\n\tofferToReceiveVideo: true\r\n};\r\n\r\nconst state = {\r\n\tlocal: null,\r\n};\r\n\r\nexport class WebRTCClient {\r\n\r\n\tremote$ = new BehaviorSubject(null);\r\n\r\n\tconstructor(stream, uid = null, remoteId = null) {\r\n\t\tthis.uid = uid || WebRTCClient.getUniqueUserId();\r\n\t\tthis.remoteId = remoteId;\r\n\t\tthis.stream = stream || new MediaStream();\r\n\t\tthis.onIceCandidate = this.onIceCandidate.bind(this);\r\n\t\tthis.onIceConnectionStateChange = this.onIceConnectionStateChange.bind(this);\r\n\t\tthis.onIceGatheringStateChange = this.onIceGatheringStateChange.bind(this);\r\n\t\tthis.onSignalingStateChange = this.onSignalingStateChange.bind(this);\r\n\t\tthis.onNegotiationceNeeded = this.onNegotiationceNeeded.bind(this);\r\n\t\tthis.onTrack = this.onTrack.bind(this);\r\n\t\t// Create an RTCPeerConnection via the polyfill.\r\n\t\tconst connection = this.connection = new RTCPeerConnection(CONNECTION_OPTIONS);\r\n\t\tif (stream) {\r\n\t\t\tstream.getTracks().forEach(track => connection.addTrack(track, stream));\r\n\t\t}\r\n\t\tconnection.addEventListener('icecandidate', this.onIceCandidate);\r\n\t\tconnection.addEventListener('iceconnectionstatechange', this.onIceConnectionStateChange);\r\n\t\tconnection.addEventListener('icegatheringstatechange', this.onIceGatheringStateChange);\r\n\t\tconnection.addEventListener('signalingstatechange', this.onSignalingStateChange);\r\n\t\tconnection.addEventListener('negotiationneeded', this.onNegotiationceNeeded);\r\n\t\tconnection.addEventListener('track', this.onTrack);\r\n\t\t// !!! cancel on dispose\r\n\t\tSignalingService.in$.pipe(\r\n\t\t\t// tap(event => console.log(event)),\r\n\t\t\tfilter(event => event.uid !== this.uid),\r\n\t\t).subscribe(message => {\r\n\t\t\t// console.log('WebRTCClient.message', message);\r\n\t\t\tswitch (message.type) {\r\n\t\t\t\tcase 'candidate':\r\n\t\t\t\t\tthis.onMessageCandidate(message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t/*\r\n\t\t\tcase 'offer':\r\n\t\t\t\tthis.onMessageOffer(message);\r\n\t\t\t\tbreak;\r\n\t\t\t\t*/\r\n\t\t\t\tcase 'answer':\r\n\t\t\t\t\tthis.onMessageAnswer(message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// this.sendOffer();\r\n\t}\r\n\r\n\tdispose() {\r\n\t\tthis.remote$.next(null);\r\n\r\n\t\tconst connection = this.connection;\r\n\t\tif (connection) {\r\n\t\t\tconnection.removeEventListener('icecandidate', this.onIceCandidate);\r\n\t\t\tconnection.removeEventListener('iceconnectionstatechange', this.onIceConnectionStateChange);\r\n\t\t\tconnection.removeEventListener('icegatheringstatechange', this.onIceGatheringStateChange);\r\n\t\t\tconnection.removeEventListener('signalingstatechange', this.onSignalingStateChange);\r\n\t\t\tconnection.removeEventListener('negotiationneeded', this.onNegotiationceNeeded);\r\n\t\t\tconnection.removeEventListener('track', this.onTrack);\r\n\t\t\t/*\r\n\t\t\tconnection.getTracks().forEach(track => {\r\n\t\t\t\ttrack.stop();\r\n\t\t\t});\r\n\t\t\t*/\r\n\r\n\t\t\t/*\r\n\t\t\tconnection.getTransceivers().forEach(transceiver => {\r\n\t\t\t\ttransceiver.stop();\r\n\t\t\t});\r\n\t\t\t*/\r\n\r\n\t\t\t/*\r\n\t\t\tif (localVideo.srcObject) {\r\n\t\t\t\tlocalVideo.pause();\r\n\t\t\t\tlocalVideo.srcObject.getTracks().forEach(track => {\r\n\t\t\t\t\ttrack.stop();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\t// Close the peer connection\r\n\r\n\t\t\tconnection.close();\r\n\t\t}\r\n\t\tthis.connection = null;\r\n\t\t// webcamStream = null;\r\n\t}\r\n\r\n\tonIceCandidate(event) {\r\n\t\t// console.log('WebRTCClient.onIceCandidate', event);\r\n\t\tconst candidate = event.candidate;\r\n\t\tif (candidate) {\r\n\t\t\tSignalingService.send({ type: 'candidate', candidate, uid: this.uid, remoteId: this.remoteId });\r\n\t\t}\r\n\t}\r\n\r\n\tonIceConnectionStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onIceConnectionStateChange', this.connection.iceConnectionState);\r\n\t\tswitch (this.connection.iceConnectionState) {\r\n\t\t\tcase 'closed':\r\n\t\t\tcase 'failed':\r\n\t\t\tcase 'disconnected':\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tonIceGatheringStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onIceGatheringStateChange', this.connection.iceGatheringState);\r\n\t}\r\n\r\n\tonSignalingStateChange(event) {\r\n\t\t// console.log('WebRTCClient.onSignalingStateChange', this.connection.signalingState);\r\n\t\tswitch (this.connection.signalingState) {\r\n\t\t\tcase 'closed':\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tonNegotiationceNeeded(event) {\r\n\t\t// console.log('WebRTCClient.onNegotiationceNeeded', event);\r\n\t\tthis.connection.createOffer(OFFER_OPTIONS).then((offer) => {\r\n\t\t\t/*\r\n\t\t\tif (this.connection.signalingState != 'stable') {\r\n\t\t\t\tconsole.log('WebRTCClient.onNegotiationceNeeded', 'The connection isn\\'t stable yet; postponing...');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tthis.connection.setLocalDescription(offer).then(_ => {\r\n\t\t\t\tSignalingService.send({ type: 'offer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t});\r\n\t\t}, (x) => this.onCreateOfferReject(x));\r\n\t}\r\n\r\n\tonTrack(event) {\r\n\t\tconst remote = event.streams[0];\r\n\t\tconsole.log('WebRTCClient.onTrack', remote);\r\n\t\tthis.remote$.next(remote);\r\n\t}\r\n\r\n\tsendOffer() {\r\n\t\tthis.connection.createOffer(OFFER_OPTIONS).then((offer) => {\r\n\t\t\tthis.connection.setLocalDescription(offer).then(_ => {\r\n\t\t\t\tSignalingService.send({ type: 'offer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t});\r\n\t\t}, (x) => this.onCreateOfferReject(x));\r\n\t}\r\n\r\n\tonMessageCandidate(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log('WebRTCClient.onMessageCandidate', 'uid', message.uid);\r\n\t\tthis.connection.addIceCandidate(message.candidate).then(() => {\r\n\t\t\t// console.log('WebRTCService.onAddIceCandidateResolve', message.candidate.candidate);\r\n\t\t}, this.onAddIceCandidateReject);\r\n\t}\r\n\r\n\tonMessageOffer(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log('WebRTCClient.onMessageOffer', 'uid', message.uid);\r\n\t\tconst description = new RTCSessionDescription(message.description);\r\n\t\tconst onAnswer = () => {\r\n\t\t\tthis.connection.createAnswer().then((answer) => {\r\n\t\t\t\tthis.connection.setLocalDescription(answer).then(_ => {\r\n\t\t\t\t\tSignalingService.send({ type: 'answer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t\t});\r\n\t\t\t}, (x) => this.onCreateAnswerReject(x));\r\n\t\t}\r\n\t\tif (this.connection.signalingState != 'stable') {\r\n\t\t\tPromise.all([\r\n\t\t\t\tthis.connection.setLocalDescription({ type: 'rollback' }),\r\n\t\t\t\tthis.connection.setRemoteDescription(description).catch(error => {\r\n\t\t\t\t\tconsole.log('WebRTCClient.onMessageOffer.setRemoteDescription.error', error);\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tthis.connection.setRemoteDescription(description).then(_ => {\r\n\t\t\t\tonAnswer();\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.log('WebRTCClient.onMessageOffer.setRemoteDescription.error', error);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tonMessageAnswer(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log('WebRTCClient.onMessageAnswer', 'uid', message.uid);\r\n\t\t// Since the 'remote' side has no media stream we need\r\n\t\t// to pass in the right constraints in order for it to\r\n\t\t// accept the incoming offer of audio and video.\r\n\t\tthis.connection.setRemoteDescription(new RTCSessionDescription(message.description)).catch(error => {\r\n\t\t\tconsole.log('WebRTCClient.onMessageAnswer.setRemoteDescription.error', error);\r\n\t\t});\r\n\t}\r\n\r\n\tonAddIceCandidateReject(error) {\r\n\t\tconsole.log('WebRTCClient.onAddIceCandidateReject.error', error);\r\n\t}\r\n\r\n\tonCreateOfferReject(error) {\r\n\t\tconsole.log('WebRTCClient.onCreateOfferReject.error', error);\r\n\t}\r\n\r\n\tonCreateAnswerReject(error) {\r\n\t\tconsole.log('WebRTCClient.onCreateAnswerReject.error', error);\r\n\t}\r\n\r\n\tstatic call(stream, uid = null, remoteId = null) {\r\n\t\t// console.log('WebRTCClient.call', remoteId);\r\n\t\tconst client = new WebRTCClient(stream, uid, remoteId);\r\n\t\treturn client;\r\n\t}\r\n\r\n\tstatic answer(stream, uid = null, remoteId = null) {\r\n\t\t// console.log('WebRTCClient.answer', remoteId);\r\n\t\tconst client = new WebRTCClient(stream, uid, remoteId);\r\n\t\treturn client;\r\n\t}\r\n\r\n\tstatic getUniqueUserId() {\r\n\t\t// max safe integer 9007199254740991 length 16\r\n\t\t// max allowed integer 4294967296 2^32\r\n\t\tconst m = 9007199254740991;\r\n\t\tconst mult = 10000000000000;\r\n\t\tconst a = (1 + Math.floor(Math.random() * 8)) * 100;\r\n\t\tconst b = (1 + Math.floor(Math.random() * 8)) * 10;\r\n\t\tconst c = (1 + Math.floor(Math.random() * 8)) * 1;\r\n\t\tconst combo = (a + b + c);\r\n\t\tconst date = Date.now();\r\n\t\tconst uid = combo * mult + date;\r\n\t\t// console.log(combo);\r\n\t\t// console.log(date);\r\n\t\t// console.log(m);\r\n\t\t// console.log('AgoraService.getUniqueUserId', uid);\r\n\t\treturn uid.toString();\r\n\t\t// return Math.floor(Math.random() * 100000) + '-' + new Date().getTime();\r\n\t}\r\n}\r\n\r\nexport class WebRTCClientService {\r\n\r\n\tstatic remotes$ = new ReplaySubject().pipe(\r\n\t\tswitchAll(),\r\n\t);\r\n\tstatic peers$ = new BehaviorSubject([]);\r\n\r\n\tstatic addPeer(stream, uid, peerId) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst index = peers.reduce((p, c, i) => {\r\n\t\t\treturn c.remoteId === peerId ? i : p;\r\n\t\t}, -1);\r\n\t\tif (index !== -1) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tconst client = new WebRTCClient(stream, uid, peerId);\r\n\t\t\tpeers.push(client);\r\n\t\t\tthis.peers$.next(peers);\r\n\t\t\tthis.switchRemotes();\r\n\t\t\treturn client;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic addPeers(stream, uid, peerIds) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tpeerIds.forEach(peerId => {\r\n\t\t\tconst client = new WebRTCClient(stream, uid, peerId);\r\n\t\t\tpeers.push(client);\r\n\t\t})\r\n\t\tthis.peers$.next(peers);\r\n\t\tthis.switchRemotes();\r\n\t}\r\n\r\n\tstatic removePeer(peerId) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst index = peers.reduce((p, c, i) => {\r\n\t\t\treturn c.remoteId === peerId ? i : p;\r\n\t\t}, -1);\r\n\t\tif (index !== -1) {\r\n\t\t\tconst client = peers[index];\r\n\t\t\tclient.dispose();\r\n\t\t\tpeers.splice(index, 1);\r\n\t\t\tthis.peers$.next(peers);\r\n\t\t\tthis.switchRemotes();\r\n\t\t}\r\n\t}\r\n\r\n\tstatic switchRemotes() {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst remotes = peers.map(client => client.remote$);\r\n\t\tconst remotes$ = remotes.length ? combineLatest(remotes) : of([]);\r\n\t\tWebRTCClientService.remotes$.next(remotes$);\r\n\t}\r\n\r\n}\r\n","import { Component, getContext } from 'rxcomp';\r\nimport { filter, takeUntil, tap } from 'rxjs/operators';\r\nimport { SignalingService } from './signaling/signaling.service';\r\nimport { UserMediaService } from './user-media/user-media.service';\r\nimport { WebSocketService } from './web-socket/web-socket.service';\r\nimport { WebRTCClientService } from './webrtc/webrtc-client.service';\r\n\r\nexport default class AppComponent extends Component {\r\n\r\n\tget remotePeers() {\r\n\t\treturn (this.peers || []).filter(x => x !== this.uid);\r\n\t}\r\n\r\n\tonInit() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tnode.classList.remove('hidden');\r\n\t\t// console.log('AppComponent');\r\n\r\n\t\tthis.local = null;\r\n\t\tthis.uid = null;\r\n\t\tthis.peers = [];\r\n\t\tthis.remotes = [];\r\n\t\tthis.streams = [];\r\n\r\n\t\tSignalingService.in$.pipe(\r\n\t\t\ttap(message => {\r\n\t\t\t\t// console.log('AppComponent.SignalingService.in$', message);\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tcase 'socketConnected':\r\n\t\t\t\t\t\tthis.onSocketConnected();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'joined':\r\n\t\t\t\t\t\tthis.onJoined(message.peerId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'leaved':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peers':\r\n\t\t\t\t\t\tthis.onPeers(message.peers);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerJoined':\r\n\t\t\t\t\t\tif (message.peerId !== this.uid) {\r\n\t\t\t\t\t\t\tthis.onPeerJoined(message.peerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerLeaved':\r\n\t\t\t\t\t\tif (message.peerId !== this.uid) {\r\n\t\t\t\t\t\t\tthis.onPeerLeaved(message.peerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerInfo':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerInfos':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'offer':\r\n\t\t\t\t\t\tthis.onOffer(message);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t).subscribe();\r\n\r\n\t\t// rewire messages to socket service\r\n\t\tSignalingService.out$.pipe(\r\n\t\t\tfilter(message => {\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttap(message => WebSocketService.send(message)),\r\n\t\t).subscribe();\r\n\r\n\t\tWebRTCClientService.remotes$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(remotes => {\r\n\t\t\t// console.log('AppComponent.remotes', remotes);\r\n\t\t\tthis.remotes = remotes;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonJoin(event) {\r\n\t\tif (this.uid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tUserMediaService.getUserMedia().then(stream => {\r\n\t\t\tthis.local = stream;\r\n\t\t\tthis.pushChanges();\r\n\t\t\tWebSocketService.connect(null, (message) => SignalingService.in(message));\r\n\t\t});\r\n\t}\r\n\r\n\tonSocketConnected() {\r\n\t\tSignalingService.out({ type: 'join', uid: WebSocketService.uid, info: { firstName: 'Jhon', lastName: 'Appleseed' } });\r\n\t}\r\n\r\n\tonJoined(uid) {\r\n\t\tthis.uid = WebSocketService.uid = uid;\r\n\t\tthis.pushChanges();\r\n\t\tWebSocketService.send({ type: 'peers', uid: WebSocketService.uid });\r\n\t}\r\n\r\n\tonPeers(peers) {\r\n\t\tthis.peers = peers;\r\n\t\tWebRTCClientService.addPeers(this.local, this.uid, this.remotePeers);\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonPeerJoined(peerId) {\r\n\t\tconst index = this.peers.indexOf(peerId);\r\n\t\tif (index === -1) {\r\n\t\t\tthis.peers.push(peerId);\r\n\t\t\tthis.pushChanges();\r\n\t\t}\r\n\t}\r\n\r\n\tonPeerLeaved(peerId) {\r\n\t\tconst index = this.peers.indexOf(peerId);\r\n\t\tif (index !== -1) {\r\n\t\t\tthis.peers.splice(index, 1);\r\n\t\t\tthis.pushChanges();\r\n\t\t}\r\n\t\tWebRTCClientService.removePeer(peerId);\r\n\t}\r\n\r\n\tonOffer(message) {\r\n\t\t// console.log('AppComponent.onOffer', message);\r\n\t\tconst client = WebRTCClientService.addPeer(this.local, this.uid, message.uid);\r\n\t\tif (client != null) {\r\n\t\t\tclient.onMessageOffer(message);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nAppComponent.meta = {\r\n\tselector: '[app-component]',\r\n};\r\n","\r\nexport const environmentServed = {\r\n\tflags: {\r\n\t\tproduction: true,\r\n\t},\r\n\tlogo: null,\r\n\tbackground: {\r\n\t\timage: '/Client/docs/img/background.jpg',\r\n\t\tvideo: '/Client/docs/img/background.mp4',\r\n\t},\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\tassets: '/Client/docs/',\r\n\tworker: '/Client/docs/js/workers/image.service.worker.js',\r\n\tgithubDocs: 'https://raw.githubusercontent.com/actarian/terranova/main/docs/',\r\n\turl: {\r\n\t\tindex: '/',\r\n\t},\r\n\tlanguages: ['en'],\r\n\tdefaultLanguage: 'en',\r\n};\r\n","\r\nexport class Utils {\r\n\r\n\tstatic merge(target, source) {\r\n\t\tif (typeof source === 'object') {\r\n\t\t\tObject.keys(source).forEach(key => {\r\n\t\t\t\tconst value = source[key];\r\n\t\t\t\tif (typeof value === 'object' && !Array.isArray(value)) {\r\n\t\t\t\t\ttarget[key] = this.merge(target[key], value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[key] = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn target;\r\n\t}\r\n\r\n}\r\n","import { environmentServed } from './environment.served';\r\nimport { environmentStatic } from './environment.static';\r\nimport { Utils } from './utils/utils';\r\n\r\nexport const NODE = (typeof module !== 'undefined' && module.exports);\r\nexport const PARAMS = NODE ? { get: () => { } } : new URLSearchParams(window.location.search);\r\nexport const DEBUG = false || (PARAMS.get('debug') != null);\r\nexport const BASE_HREF = NODE ? null : document.querySelector('base').getAttribute('href');\r\nexport const HEROKU = NODE ? false : (window && window.location.host.indexOf('herokuapp') !== -1);\r\nexport const STATIC = NODE ? false : (HEROKU || (window && (window.location.port === '41789' || window.location.port === '5000' || window.location.port === '6443' || window.location.host === 'actarian.github.io')));\r\nexport const DEVELOPMENT = NODE ? false : (window && ['localhost', '127.0.0.1', '0.0.0.0'].indexOf(window.location.host.split(':')[0]) !== -1);\r\nexport const PRODUCTION = !DEVELOPMENT;\r\nexport const ENV = {\r\n\tSTATIC,\r\n\tDEVELOPMENT,\r\n\tPRODUCTION\r\n};\r\n\r\nexport class Environment {\r\n\r\n\tget STATIC() {\r\n\t\treturn ENV.STATIC;\r\n\t}\r\n\tset STATIC(STATIC) {\r\n\t\tENV.STATIC = (STATIC === true || STATIC === 'true');\r\n\t\t// console.log('Environment.STATIC.set', ENV.STATIC);\r\n\t}\r\n\r\n\tget href() {\r\n\t\tif (HEROKU) {\r\n\t\t\treturn this.githubDocs;\r\n\t\t} else {\r\n\t\t\treturn BASE_HREF;\r\n\t\t}\r\n\t}\r\n\r\n\tgetAbsoluteUrl(path, params) {\r\n\t\tlet url = `${window.location.origin}${path}`;\r\n\t\t// let url = `${window.location.protocol}//${window.location.host}${path}`;\r\n\t\tObject.keys(params).forEach(key => {\r\n\t\t\turl = url.replace(`$${key}`, params[key]);\r\n\t\t});\r\n\t\treturn url;\r\n\t}\r\n\r\n\tgetPath(path) {\r\n\t\treturn this.isLocal(path) ? (this.href + path) : path;\r\n\t}\r\n\r\n\tisLocal(path) {\r\n\t\treturn path.indexOf('://') === -1;\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tif (options) {\r\n\t\t\tif (typeof options.url === 'object') {\r\n\t\t\t\tconst language = options.language || '';\r\n\t\t\t\tconst market = options.market || '';\r\n\t\t\t\tObject.keys(options.url).forEach(key => {\r\n\t\t\t\t\toptions.url[key] = language + market + options.url[key];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tObject.assign(this, options);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst defaultOptions = {\r\n\tport: 5000,\r\n\tfontFamily: 'GT Walsheim, sans-serif',\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\teditor: {\r\n\t\tdisabledViewTypes: ['waiting-room', 'room-3d'],\r\n\t\tdisabledViewItemTypes: ['texture'],\r\n\t},\r\n\trenderOrder: {\r\n\t\tpanorama: 0,\r\n\t\tmodel: 10,\r\n\t\tplane: 20,\r\n\t\ttile: 30,\r\n\t\tbanner: 40,\r\n\t\tnav: 50,\r\n\t\tpanel: 60,\r\n\t\tmenu: 70,\r\n\t\tdebug: 80,\r\n\t\tpointer: 90,\r\n\t}\r\n};\r\n\r\nconst defaultAppOptions = {\r\n\tchannelName: 'BHere',\r\n\tflags: {\r\n\t\tproduction: false,\r\n\t\tuseProxy: false,\r\n\t\tuseToken: false,\r\n\t\tselfService: true,\r\n\t\tguidedTourRequest: true,\r\n\t\teditor: true,\r\n\t\tar: true,\r\n\t\tmenu: true,\r\n\t\tattendee: true,\r\n\t\tstreamer: true,\r\n\t\tviewer: true,\r\n\t\tsmartDevice: true,\r\n\t\tmaxQuality: false,\r\n\t\theroku: HEROKU,\r\n\t},\r\n};\r\n\r\nconst environmentOptions = window.STATIC ? environmentStatic : environmentServed;\r\n\r\nlet options = Object.assign(defaultOptions, defaultAppOptions, environmentOptions);\r\noptions = Utils.merge(options, window.bhere);\r\n\r\nexport const environment = new Environment(options);\r\n\r\nconsole.log('environment', environment);\r\n","\r\nexport const environmentStatic = {\r\n\tflags: {\r\n\t\tproduction: false,\r\n\t},\r\n\tlogo: null,\r\n\tbackground: {\r\n\t\timage: '/terranova/img/background.jpg',\r\n\t\tvideo: '/terranova/img/background.mp4',\r\n\t},\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\tassets: '/terranova/',\r\n\tworker: './js/workers/image.service.worker.js',\r\n\tgithubDocs: 'https://raw.githubusercontent.com/actarian/terranova/main/docs/',\r\n\turl: {\r\n\t\tindex: '/',\r\n\t},\r\n\tlanguages: ['en'],\r\n\tdefaultLanguage: 'en',\r\n};\r\n","import { Pipe } from \"rxcomp\";\r\nimport { environment } from \"../environment\";\r\n\r\nexport default class FlagPipe extends Pipe {\r\n\r\n\tstatic transform(key) {\r\n\t\tconst flags = environment.flags;\r\n\t\treturn flags[key] || false;\r\n\t}\r\n\r\n}\r\n\r\nFlagPipe.meta = {\r\n\tname: 'flag',\r\n};\r\n","import { Component, getContext } from 'rxcomp';\r\n\r\nexport default class WebRTCStreamComponent extends Component {\r\n\r\n\tonInit() {\r\n\t\tthis.muted = true;\r\n\t}\r\n\r\n\tonChanges() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tconst video = node.querySelector('video');\r\n\t\tif (video.srcObject !== this.stream) {\r\n\t\t\tvideo.srcObject = this.stream;\r\n\t\t\t// console.log('WebRTCStreamComponent', video, this.stream);\r\n\t\t}\r\n\t}\r\n\r\n\tonMuteToggle() {\r\n\t\tthis.muted = !this.muted;\r\n\t\tconst { node } = getContext(this);\r\n\t\tconst video = node.querySelector('video');\r\n\t\tvideo.muted = this.muted;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n}\r\n\r\nWebRTCStreamComponent.meta = {\r\n\tselector: '[webrtc-stream]',\r\n\tinputs: ['stream'],\r\n\ttemplate: /* html */ `\r\n\t\t<div class=\"webrtc-stream\">\r\n\t\t\t<video playsinline autoplay muted></video>\r\n\t\t\t<button type=\"button\" class=\"btn--muted\" (click)=\"onMuteToggle()\">\r\n\t\t\t\t<svg class=\"mic-muted\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" *if=\"muted\"><use xlink:href=\"#mic-muted\"></use></svg>\r\n\t\t\t\t<svg class=\"mic\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" *if=\"!muted\"><use xlink:href=\"#mic\"></use></svg>\r\n\t\t\t</button>\r\n\t\t</div>\r\n\t`\r\n};\r\n","import { CoreModule, Module } from 'rxcomp';\r\nimport AppComponent from './app.component';\r\nimport FlagPipe from './flag/flag.pipe';\r\nimport WebRTCStreamComponent from './webrtc/webrtc-stream.component';\r\n\r\nexport class AppModule extends Module { }\r\n\r\nAppModule.meta = {\r\n\timports: [\r\n\t\tCoreModule,\r\n\t],\r\n\tdeclarations: [\r\n\t\tFlagPipe,\r\n\t\tWebRTCStreamComponent,\r\n\t],\r\n\tbootstrap: AppComponent,\r\n};\r\n","import { Browser } from 'rxcomp';\r\nimport { AppModule } from './app.module';\r\n\r\nBrowser.bootstrap(AppModule);\r\n"]}