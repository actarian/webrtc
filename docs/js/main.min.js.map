{"version":3,"sources":["src/js/main.js","../../src/js/webrtc/signaling.service.js","../../src/js/webrtc/user-media.service.js","../../src/js/webrtc/webrtc-client.service.js","../../src/js/webrtc/websocket.service.js","../../src/js/app.component.js","../../src/js/environment.served.js","../../src/js/utils/utils.js","../../src/js/environment.js","../../src/js/environment.static.js","../../src/js/flag/flag.pipe.js","../../src/js/webrtc/webrtc-stream.component.js","../../src/js/app.module.js","../../src/js/main.js"],"names":["g","f","exports","module","require","define","amd","globalThis","self","rxcomp","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_defineProperty","obj","value","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","SignalingService","in","message","in$","next","out","out$","send","sendBack","assign","clientId","remoteId","broadcast","ReplaySubject","UserMediaService","getUserMedia","Promise","resolve","reject","navigator","mediaDevices","audio","video","width","min","ideal","max","height","then","stream","catch","error","console","log","CONNECTION_OPTIONS","iceServers","urls","OFFER_OPTIONS","offerToReceiveAudio","offerToReceiveVideo","WebRTCClient","uid","_this","BehaviorSubject","getUniqueUserId","MediaStream","onIceCandidate","bind","onIceConnectionStateChange","onIceGatheringStateChange","onSignalingStateChange","onNegotiationceNeeded","onTrack","connection","RTCPeerConnection","getTracks","forEach","track","addTrack","addEventListener","pipe","filter","event","subscribe","type","onMessageCandidate","onMessageAnswer","_proto","dispose","remote$","removeEventListener","close","candidate","iceConnectionState","iceGatheringState","signalingState","_this2","createOffer","offer","setLocalDescription","_","description","localDescription","x","onCreateOfferReject","remote","streams","sendOffer","_this3","addIceCandidate","onAddIceCandidateReject","onMessageOffer","_this4","RTCSessionDescription","setRemoteDescription","createAnswer","answer","onCreateAnswerReject","all","call","Math","floor","random","Date","now","toString","WebRTCClientService","addPeer","peerId","peers","peers$","getValue","slice","reduce","c","client","push","switchRemotes","addPeers","peerIds","removePeer","index","splice","remotes","map","remotes$","combineLatest","of","switchAll","WebSocketService","connect","onMessageCallback","onOpen","onClose","onMessage","host","location","origin","replace","socket","WebSocket","disconnect","message$","JSON","parse","data","response","backMessage","timeStamp","stringify","sendAll","AppComponent","_Component","apply","arguments","onInit","getContext","node","classList","remove","local","tap","onSocketConnected","onJoined","onPeers","onPeerJoined","onPeerLeaved","onOffer","takeUntil","unsubscribe$","pushChanges","onJoin","info","firstName","lastName","remotePeers","indexOf","onCall","get","Component","meta","selector","Utils","merge","source","keys","Array","isArray","NODE","BASE_HREF","URLSearchParams","window","search","document","querySelector","getAttribute","HEROKU","STATIC","port","DEVELOPMENT","split","ENV","PRODUCTION","Environment","options","url","language","market","getAbsoluteUrl","path","params","getPath","isLocal","href","set","githubDocs","defaultAppOptions","channelName","flags","production","useProxy","useToken","selfService","guidedTourRequest","editor","ar","menu","attendee","streamer","viewer","smartDevice","maxQuality","heroku","environmentOptions","logo","background","image","colors","menuBackground","menuForeground","menuOverBackground","menuOverForeground","menuBackBackground","menuBackForeground","menuBackOverBackground","menuBackOverForeground","assets","worker","languages","defaultLanguage","fontFamily","disabledViewTypes","disabledViewItemTypes","renderOrder","panorama","model","plane","tile","banner","nav","panel","debug","pointer","environment","bhere","FlagPipe","_Pipe","transform","Pipe","name","WebRTCStreamComponent","onChanges","srcObject","inputs","template","AppModule","_Module","Module","imports","CoreModule","declarations","bootstrap","Browser"],"mappings":"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","file":"docs\\js\\main.min.js","sourcesContent":[null,"import { ReplaySubject } from 'rxjs';\r\n\r\nexport class SignalingService {\r\n\r\n\tstatic in$ = new ReplaySubject(1);\r\n\tstatic in(message) {\r\n\t\tSignalingService.in$.next(message);\r\n\t}\r\n\r\n\tstatic out$ = new ReplaySubject(1);\r\n\tstatic out(message) {\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic send(message) {\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic sendBack(message) {\r\n\t\tmessage = Object.assign({}, message, { clientId: message.remoteId, remoteId: message.clientId });\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic broadcast(message) {\r\n\t\tmessage.broadcast = true;\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\r\n}\r\n","\r\nexport class UserMediaService {\r\n\r\n\tstatic stream = null;\r\n\r\n\tstatic getUserMedia() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options = {\r\n\t\t\t\taudio: true,\r\n\t\t\t\tvideo: {\r\n\t\t\t\t\twidth: { min: 320, ideal: 640, max: 640 },\r\n\t\t\t\t\theight: { min: 240, ideal: 480, max: 480 }\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tnavigator.mediaDevices.getUserMedia(options).then((stream) => {\r\n\t\t\t\t// console.log('UserMediaService.getUserMedia', stream);\r\n\t\t\t\tUserMediaService.stream = stream;\r\n\t\t\t\t/*/\r\n\t\t\t\tconst audioTracks = stream.getAudioTracks();\r\n\t\t\t\tif (audioTracks.length > 0) {\r\n\t\t\t\t\tconsole.log('UserMediaService.audioTracks', audioTracks[0].label);\r\n\t\t\t\t}\r\n\t\t\t\tconst videoTracks = stream.getVideoTracks();\r\n\t\t\t\tif (videoTracks.length > 0) {\r\n\t\t\t\t\tconsole.log('UserMediaService.videoTracks', videoTracks[0].label);\r\n\t\t\t\t}\r\n\t\t\t\t/*/\r\n\t\t\t\tresolve(stream);\r\n\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.log('UserMediaService.getUserMedia.error', error);\r\n\t\t\t\treject(error);\r\n\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n}\r\n","import { BehaviorSubject, combineLatest, of, ReplaySubject } from 'rxjs';\r\nimport { filter, switchAll } from 'rxjs/operators';\r\nimport { SignalingService } from './signaling.service';\r\n\r\nconst CONNECTION_OPTIONS = {\r\n\ticeServers: [{\r\n\t\turls: 'stun:stunserver.org'\r\n\t}]\r\n};\r\n\r\nconst OFFER_OPTIONS = {\r\n\tofferToReceiveAudio: true,\r\n\tofferToReceiveVideo: true\r\n};\r\n\r\nconst state = {\r\n\tlocal: null,\r\n};\r\n\r\nexport class WebRTCClient {\r\n\r\n\tremote$ = new BehaviorSubject(null);\r\n\r\n\tconstructor(stream, uid = null, remoteId = null) {\r\n\t\tthis.uid = uid || WebRTCClient.getUniqueUserId();\r\n\t\tthis.remoteId = remoteId;\r\n\t\tthis.stream = stream || new MediaStream();\r\n\t\tthis.onIceCandidate = this.onIceCandidate.bind(this);\r\n\t\tthis.onIceConnectionStateChange = this.onIceConnectionStateChange.bind(this);\r\n\t\tthis.onIceGatheringStateChange = this.onIceGatheringStateChange.bind(this);\r\n\t\tthis.onSignalingStateChange = this.onSignalingStateChange.bind(this);\r\n\t\tthis.onNegotiationceNeeded = this.onNegotiationceNeeded.bind(this);\r\n\t\tthis.onTrack = this.onTrack.bind(this);\r\n\t\t// Create an RTCPeerConnection via the polyfill.\r\n\t\tconst connection = this.connection = new RTCPeerConnection(CONNECTION_OPTIONS);\r\n\t\tif (stream) {\r\n\t\t\tstream.getTracks().forEach(track => connection.addTrack(track, stream));\r\n\t\t}\r\n\t\tconnection.addEventListener('icecandidate', this.onIceCandidate);\r\n\t\tconnection.addEventListener('iceconnectionstatechange', this.onIceConnectionStateChange);\r\n\t\tconnection.addEventListener('icegatheringstatechange', this.onIceGatheringStateChange);\r\n\t\tconnection.addEventListener('signalingstatechange', this.onSignalingStateChange);\r\n\t\tconnection.addEventListener('negotiationneeded', this.onNegotiationceNeeded);\r\n\t\tconnection.addEventListener('track', this.onTrack);\r\n\t\t// !!! cancel on dispose\r\n\t\tSignalingService.in$.pipe(\r\n\t\t\t// tap(event => console.log(event)),\r\n\t\t\tfilter(event => event.uid !== this.uid),\r\n\t\t).subscribe(message => {\r\n\t\t\t// console.log('WebRTCClient.message', message);\r\n\t\t\tswitch (message.type) {\r\n\t\t\t\tcase 'candidate':\r\n\t\t\t\t\tthis.onMessageCandidate(message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t/*\r\n\t\t\tcase 'offer':\r\n\t\t\t\tthis.onMessageOffer(message);\r\n\t\t\t\tbreak;\r\n\t\t\t\t*/\r\n\t\t\t\tcase 'answer':\r\n\t\t\t\t\tthis.onMessageAnswer(message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// this.sendOffer();\r\n\t}\r\n\r\n\tdispose() {\r\n\t\tthis.remote$.next(null);\r\n\r\n\t\tconst connection = this.connection;\r\n\t\tconnection.removeEventListener('icecandidate', this.onIceCandidate);\r\n\t\tconnection.removeEventListener('iceconnectionstatechange', this.onIceConnectionStateChange);\r\n\t\tconnection.removeEventListener('icegatheringstatechange', this.onIceGatheringStateChange);\r\n\t\tconnection.removeEventListener('signalingstatechange', this.onSignalingStateChange);\r\n\t\tconnection.removeEventListener('negotiationneeded', this.onNegotiationceNeeded);\r\n\t\tconnection.removeEventListener('track', this.onTrack);\r\n\t\t/*\r\n\t\tconnection.getTracks().forEach(track => {\r\n\t\t\ttrack.stop();\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\tconnection.getTransceivers().forEach(transceiver => {\r\n\t\t\ttransceiver.stop();\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\tif (localVideo.srcObject) {\r\n\t\t\tlocalVideo.pause();\r\n\t\t\tlocalVideo.srcObject.getTracks().forEach(track => {\r\n\t\t\t\ttrack.stop();\r\n\t\t\t});\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// Close the peer connection\r\n\r\n\t\tconnection.close();\r\n\t\tthis.connection = null;\r\n\t\t// webcamStream = null;\r\n\t}\r\n\r\n\tonIceCandidate(event) {\r\n\t\t// console.log('WebRTCClient.onIceCandidate', event);\r\n\t\tconst candidate = event.candidate;\r\n\t\tif (candidate) {\r\n\t\t\tSignalingService.send({ type: 'candidate', candidate, uid: this.uid, remoteId: this.remoteId });\r\n\t\t}\r\n\t}\r\n\r\n\tonIceConnectionStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onIceConnectionStateChange', this.connection.iceConnectionState);\r\n\t\tswitch (this.connection.iceConnectionState) {\r\n\t\t\tcase 'closed':\r\n\t\t\tcase 'failed':\r\n\t\t\tcase 'disconnected':\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tonIceGatheringStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onIceGatheringStateChange', this.connection.iceGatheringState);\r\n\t}\r\n\r\n\tonSignalingStateChange(event) {\r\n\t\t// console.log('WebRTCClient.onSignalingStateChange', this.connection.signalingState);\r\n\t\tswitch (this.connection.signalingState) {\r\n\t\t\tcase 'closed':\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tonNegotiationceNeeded(event) {\r\n\t\t// console.log('WebRTCClient.onNegotiationceNeeded', event);\r\n\t\tthis.connection.createOffer(OFFER_OPTIONS).then((offer) => {\r\n\t\t\t/*\r\n\t\t\tif (this.connection.signalingState != 'stable') {\r\n\t\t\t\tconsole.log('WebRTCClient.onNegotiationceNeeded', 'The connection isn\\'t stable yet; postponing...');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tthis.connection.setLocalDescription(offer).then(_ => {\r\n\t\t\t\tSignalingService.send({ type: 'offer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t});\r\n\t\t}, (x) => this.onCreateOfferReject(x));\r\n\t}\r\n\r\n\tonTrack(event) {\r\n\t\tconst remote = event.streams[0];\r\n\t\tconsole.log('WebRTCClient.onTrack', remote);\r\n\t\tthis.remote$.next(remote);\r\n\t}\r\n\r\n\tsendOffer() {\r\n\t\tthis.connection.createOffer(OFFER_OPTIONS).then((offer) => {\r\n\t\t\tthis.connection.setLocalDescription(offer).then(_ => {\r\n\t\t\t\tSignalingService.send({ type: 'offer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t});\r\n\t\t}, (x) => this.onCreateOfferReject(x));\r\n\t}\r\n\r\n\tonMessageCandidate(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log('WebRTCClient.onMessageCandidate', 'uid', message.uid);\r\n\t\tthis.connection.addIceCandidate(message.candidate).then(() => {\r\n\t\t\t// console.log('WebRTCService.onAddIceCandidateResolve', message.candidate.candidate);\r\n\t\t}, this.onAddIceCandidateReject);\r\n\t}\r\n\r\n\tonMessageOffer(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log('WebRTCClient.onMessageOffer', 'uid', message.uid);\r\n\t\tconst description = new RTCSessionDescription(message.description);\r\n\t\tconst onAnswer = () => {\r\n\t\t\tthis.connection.createAnswer().then((answer) => {\r\n\t\t\t\tthis.connection.setLocalDescription(answer).then(_ => {\r\n\t\t\t\t\tSignalingService.send({ type: 'answer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t\t});\r\n\t\t\t}, (x) => this.onCreateAnswerReject(x));\r\n\t\t}\r\n\t\tif (this.connection.signalingState != 'stable') {\r\n\t\t\tPromise.all([\r\n\t\t\t\tthis.connection.setLocalDescription({ type: 'rollback' }),\r\n\t\t\t\tthis.connection.setRemoteDescription(description).catch(error => {\r\n\t\t\t\t\tconsole.log('WebRTCClient.onMessageOffer.setRemoteDescription.error', error);\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tthis.connection.setRemoteDescription(description).then(_ => {\r\n\t\t\t\tonAnswer();\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.log('WebRTCClient.onMessageOffer.setRemoteDescription.error', error);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tonMessageAnswer(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log('WebRTCClient.onMessageAnswer', 'uid', message.uid);\r\n\t\t// Since the 'remote' side has no media stream we need\r\n\t\t// to pass in the right constraints in order for it to\r\n\t\t// accept the incoming offer of audio and video.\r\n\t\tthis.connection.setRemoteDescription(new RTCSessionDescription(message.description)).catch(error => {\r\n\t\t\tconsole.log('WebRTCClient.onMessageAnswer.setRemoteDescription.error', error);\r\n\t\t});\r\n\t}\r\n\r\n\tonAddIceCandidateReject(error) {\r\n\t\tconsole.log('WebRTCClient.onAddIceCandidateReject.error', error);\r\n\t}\r\n\r\n\tonCreateOfferReject(error) {\r\n\t\tconsole.log('WebRTCClient.onCreateOfferReject.error', error);\r\n\t}\r\n\r\n\tonCreateAnswerReject(error) {\r\n\t\tconsole.log('WebRTCClient.onCreateAnswerReject.error', error);\r\n\t}\r\n\r\n\tstatic call(stream, uid = null, remoteId = null) {\r\n\t\t// console.log('WebRTCClient.call', remoteId);\r\n\t\tconst client = new WebRTCClient(stream, uid, remoteId);\r\n\t\treturn client;\r\n\t}\r\n\r\n\tstatic answer(stream, uid = null, remoteId = null) {\r\n\t\t// console.log('WebRTCClient.answer', remoteId);\r\n\t\tconst client = new WebRTCClient(stream, uid, remoteId);\r\n\t\treturn client;\r\n\t}\r\n\r\n\tstatic getUniqueUserId() {\r\n\t\t// max safe integer 9007199254740991 length 16\r\n\t\t// max allowed integer 4294967296 2^32\r\n\t\tconst m = 9007199254740991;\r\n\t\tconst mult = 10000000000000;\r\n\t\tconst a = (1 + Math.floor(Math.random() * 8)) * 100;\r\n\t\tconst b = (1 + Math.floor(Math.random() * 8)) * 10;\r\n\t\tconst c = (1 + Math.floor(Math.random() * 8)) * 1;\r\n\t\tconst combo = (a + b + c);\r\n\t\tconst date = Date.now();\r\n\t\tconst uid = combo * mult + date;\r\n\t\t// console.log(combo);\r\n\t\t// console.log(date);\r\n\t\t// console.log(m);\r\n\t\t// console.log('AgoraService.getUniqueUserId', uid);\r\n\t\treturn uid.toString();\r\n\t\t// return Math.floor(Math.random() * 100000) + '-' + new Date().getTime();\r\n\t}\r\n}\r\n\r\nexport class WebRTCClientService {\r\n\r\n\tstatic remotes$ = new ReplaySubject().pipe(\r\n\t\tswitchAll(),\r\n\t);\r\n\tstatic peers$ = new BehaviorSubject([]);\r\n\r\n\tstatic addPeer(stream, uid, peerId) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst index = peers.reduce((p, c, i) => {\r\n\t\t\treturn c.remoteId === peerId ? i : p;\r\n\t\t}, -1);\r\n\t\tif (index !== -1) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tconst client = new WebRTCClient(stream, uid, peerId);\r\n\t\t\tpeers.push(client);\r\n\t\t\tthis.peers$.next(peers);\r\n\t\t\tthis.switchRemotes();\r\n\t\t\treturn client;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic addPeers(stream, uid, peerIds) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tpeerIds.forEach(peerId => {\r\n\t\t\tconst client = new WebRTCClient(stream, uid, peerId);\r\n\t\t\tpeers.push(client);\r\n\t\t})\r\n\t\tthis.peers$.next(peers);\r\n\t\tthis.switchRemotes();\r\n\t}\r\n\r\n\tstatic removePeer(peerId) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst index = peers.reduce((p, c, i) => {\r\n\t\t\treturn c.remoteId === peerId ? i : p;\r\n\t\t}, -1);\r\n\t\tif (index !== -1) {\r\n\t\t\tconst client = peers[index];\r\n\t\t\tclient.dispose();\r\n\t\t\tpeers.splice(index, 1);\r\n\t\t\tthis.peers$.next(peers);\r\n\t\t\tthis.switchRemotes();\r\n\t\t}\r\n\t}\r\n\r\n\tstatic switchRemotes() {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst remotes = peers.map(client => client.remote$);\r\n\t\tconst remotes$ = remotes.length ? combineLatest(remotes) : of([]);\r\n\t\tWebRTCClientService.remotes$.next(remotes$);\r\n\t}\r\n\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\n\r\nexport class WebSocketService {\r\n\r\n\tstatic message$ = new ReplaySubject(1);\r\n\r\n\tstatic connect(uid = null, onMessageCallback = null) {\r\n\t\tuid = uid || this.getUniqueUserId();\r\n\t\tthis.uid = uid;\r\n\t\tthis.onMessageCallback = onMessageCallback;\r\n\t\tthis.onOpen = this.onOpen.bind(this);\r\n\t\tthis.onClose = this.onClose.bind(this);\r\n\t\tthis.onMessage = this.onMessage.bind(this);\r\n\t\tconst host = location.origin.replace(/^https/, 'wss').replace(/^http/, 'ws');\r\n\t\tconst socket = this.socket = new WebSocket(host);\r\n\t\tsocket.addEventListener('open', this.onOpen);\r\n\t\tsocket.addEventListener('close', this.onClose);\r\n\t\tsocket.addEventListener('message', this.onMessage);\r\n\t}\r\n\r\n\tstatic disconnect() {\r\n\t\tconst socket = this.socket;\r\n\t\tif (socket) {\r\n\t\t\tsocket.close();\r\n\t\t\tthis.socket = null;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onOpen(event) {\r\n\t\t// console.log('WebSocketService.onOpen');\r\n\t\tconst message = { type: 'socketConnected' };\r\n\t\tthis.message$.next(message);\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onClose(event) {\r\n\t\t// console.log('WebSocketService.onClose');const message = { type: 'socketConnected' };\r\n\t\tconst message = { type: 'socketDisconnected' };\r\n\t\tthis.message$.next(message);\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onMessage(event) {\r\n\t\tconst message = JSON.parse(event.data);\r\n\t\t// console.log('WebSocketService.onMessage', message);\r\n\t\tif (message.remoteId) {\r\n\t\t\tmessage.sendBack = (response = {}) => {\r\n\t\t\t\tconst backMessage = Object.assign({}, message, response, { uid: message.remoteId, remoteId: message.uid });\r\n\t\t\t\tWebSocketService.send(backMessage);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t\tthis.message$.next(message);\r\n\t}\r\n\r\n\tstatic send(message = {}, broadcast) {\r\n\t\tconst socket = WebSocketService.socket;\r\n\t\tmessage.uid = this.uid;\r\n\t\tmessage.timeStamp = Date.now();\r\n\t\tif (broadcast) {\r\n\t\t\tmessage.broadcast = true;\r\n\t\t}\r\n\t\t// console.log('WebSocketService.send', message);\r\n\t\tsocket.send(JSON.stringify(message));\r\n\t}\r\n\r\n\tstatic sendAll(message = {}) {\r\n\t\tWebSocketService.send(message, true);\r\n\t}\r\n\r\n\tstatic getUniqueUserId() {\r\n\t\t// max safe integer 9007199254740991 length 16\r\n\t\t// max allowed integer 4294967296 2^32\r\n\t\tconst m = 9007199254740991;\r\n\t\tconst mult = 10000000000000;\r\n\t\tconst a = (1 + Math.floor(Math.random() * 8)) * 100;\r\n\t\tconst b = (1 + Math.floor(Math.random() * 8)) * 10;\r\n\t\tconst c = (1 + Math.floor(Math.random() * 8)) * 1;\r\n\t\tconst combo = (a + b + c);\r\n\t\tconst date = Date.now();\r\n\t\tconst uid = combo * mult + date;\r\n\t\t// console.log(combo);\r\n\t\t// console.log(date);\r\n\t\t// console.log(m);\r\n\t\t// console.log('AgoraService.getUniqueUserId', uid);\r\n\t\treturn uid.toString();\r\n\t}\r\n\r\n}\r\n","import { Component, getContext } from 'rxcomp';\r\nimport { filter, takeUntil, tap } from 'rxjs/operators';\r\nimport { SignalingService } from './webrtc/signaling.service';\r\nimport { UserMediaService } from './webrtc/user-media.service';\r\nimport { WebRTCClientService } from './webrtc/webrtc-client.service';\r\nimport { WebSocketService } from './webrtc/websocket.service';\r\n\r\nexport default class AppComponent extends Component {\r\n\r\n\tget remotePeers() {\r\n\t\treturn (this.peers || []).filter(x => x !== this.uid);\r\n\t}\r\n\r\n\tonInit() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tnode.classList.remove('hidden');\r\n\t\t// console.log('AppComponent');\r\n\r\n\t\tthis.local = null;\r\n\t\tthis.uid = null;\r\n\t\tthis.peers = [];\r\n\t\tthis.remotes = [];\r\n\t\tthis.streams = [];\r\n\r\n\t\tSignalingService.in$.pipe(\r\n\t\t\ttap(message => {\r\n\t\t\t\t// console.log('AppComponent.SignalingService.in$', message);\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tcase 'socketConnected':\r\n\t\t\t\t\t\tthis.onSocketConnected();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'joined':\r\n\t\t\t\t\t\tthis.onJoined(message.peerId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'leaved':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peers':\r\n\t\t\t\t\t\tthis.onPeers(message.peers);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerJoined':\r\n\t\t\t\t\t\tif (message.peerId !== this.uid) {\r\n\t\t\t\t\t\t\tthis.onPeerJoined(message.peerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerLeaved':\r\n\t\t\t\t\t\tif (message.peerId !== this.uid) {\r\n\t\t\t\t\t\t\tthis.onPeerLeaved(message.peerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerInfo':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerInfos':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'offer':\r\n\t\t\t\t\t\tthis.onOffer(message);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t).subscribe();\r\n\r\n\t\t// rewire messages to socket service\r\n\t\tSignalingService.out$.pipe(\r\n\t\t\tfilter(message => {\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttap(message => WebSocketService.send(message)),\r\n\t\t).subscribe();\r\n\r\n\t\tWebRTCClientService.remotes$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(remotes => {\r\n\t\t\t// console.log('AppComponent.remotes', remotes);\r\n\t\t\tthis.remotes = remotes;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonJoin(event) {\r\n\t\tif (this.uid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tUserMediaService.getUserMedia().then(stream => {\r\n\t\t\tthis.local = stream;\r\n\t\t\tthis.pushChanges();\r\n\t\t\tWebSocketService.connect(null, (message) => SignalingService.in(message));\r\n\t\t});\r\n\t}\r\n\r\n\tonSocketConnected() {\r\n\t\tSignalingService.out({ type: 'join', uid: WebSocketService.uid, info: { firstName: 'Jhon', lastName: 'Appleseed' } });\r\n\t}\r\n\r\n\tonJoined(uid) {\r\n\t\tthis.uid = WebSocketService.uid = uid;\r\n\t\tthis.pushChanges();\r\n\t\tWebSocketService.send({ type: 'peers', uid: WebSocketService.uid });\r\n\t}\r\n\r\n\tonPeers(peers) {\r\n\t\tthis.peers = peers;\r\n\t\tWebRTCClientService.addPeers(this.local, this.uid, this.remotePeers);\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonPeerJoined(peerId) {\r\n\t\tconst index = this.peers.indexOf(peerId);\r\n\t\tif (index === -1) {\r\n\t\t\tthis.peers.push(peerId);\r\n\t\t\tthis.pushChanges();\r\n\t\t}\r\n\t}\r\n\r\n\tonPeerLeaved(peerId) {\r\n\t\tconst index = this.peers.indexOf(peerId);\r\n\t\tif (index !== -1) {\r\n\t\t\tthis.peers.splice(index, 1);\r\n\t\t\tthis.pushChanges();\r\n\t\t}\r\n\t\tWebRTCClientService.removePeer(peerId);\r\n\t}\r\n\r\n\tonCall(peerId) {\r\n\t\treturn;\r\n\t\t/*\r\n\t\tconsole.log('AppComponent.onCall', peerId);\r\n\t\tconst client = this.client = WebRTCClient.call(this.local, this.uid, peerId);\r\n\t\tclient.streams$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$),\r\n\t\t).subscribe(streams => {\r\n\t\t\tthis.streams = streams;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t\t*/\r\n\t}\r\n\r\n\tonOffer(message) {\r\n\t\t// console.log('AppComponent.onOffer', message);\r\n\t\tconst client = WebRTCClientService.addPeer(this.local, this.uid, message.uid);\r\n\t\tif (client != null) {\r\n\t\t\tclient.onMessageOffer(message);\r\n\t\t}\r\n\t\t/*\r\n\t\tif (this.client) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst client = this.client = WebRTCClient.answer(this.local, this.uid, message.uid);\r\n\t\tclient.onMessageOffer(message);\r\n\t\tclient.streams$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$),\r\n\t\t).subscribe(streams => {\r\n\t\t\tthis.streams = streams;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t\t*/\r\n\t}\r\n\r\n}\r\n\r\nAppComponent.meta = {\r\n\tselector: '[app-component]',\r\n};\r\n","\r\nexport const environmentServed = {\r\n\tflags: {\r\n\t\tproduction: true,\r\n\t},\r\n\tlogo: null,\r\n\tbackground: {\r\n\t\timage: '/Client/docs/img/background.jpg',\r\n\t\tvideo: '/Client/docs/img/background.mp4',\r\n\t},\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\tassets: '/Client/docs/',\r\n\tworker: '/Client/docs/js/workers/image.service.worker.js',\r\n\tgithubDocs: 'https://raw.githubusercontent.com/actarian/terranova/main/docs/',\r\n\turl: {\r\n\t\tindex: '/',\r\n\t},\r\n\tlanguages: ['en'],\r\n\tdefaultLanguage: 'en',\r\n};\r\n","\r\nexport class Utils {\r\n\r\n\tstatic merge(target, source) {\r\n\t\tif (typeof source === 'object') {\r\n\t\t\tObject.keys(source).forEach(key => {\r\n\t\t\t\tconst value = source[key];\r\n\t\t\t\tif (typeof value === 'object' && !Array.isArray(value)) {\r\n\t\t\t\t\ttarget[key] = this.merge(target[key], value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[key] = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn target;\r\n\t}\r\n\r\n}\r\n","import { environmentServed } from './environment.served';\r\nimport { environmentStatic } from './environment.static';\r\nimport { Utils } from './utils/utils';\r\n\r\nexport const NODE = (typeof module !== 'undefined' && module.exports);\r\nexport const PARAMS = NODE ? { get: () => { } } : new URLSearchParams(window.location.search);\r\nexport const DEBUG = false || (PARAMS.get('debug') != null);\r\nexport const BASE_HREF = NODE ? null : document.querySelector('base').getAttribute('href');\r\nexport const HEROKU = NODE ? false : (window && window.location.host.indexOf('herokuapp') !== -1);\r\nexport const STATIC = NODE ? false : (HEROKU || (window && (window.location.port === '41789' || window.location.port === '5000' || window.location.port === '6443' || window.location.host === 'actarian.github.io')));\r\nexport const DEVELOPMENT = NODE ? false : (window && ['localhost', '127.0.0.1', '0.0.0.0'].indexOf(window.location.host.split(':')[0]) !== -1);\r\nexport const PRODUCTION = !DEVELOPMENT;\r\nexport const ENV = {\r\n\tSTATIC,\r\n\tDEVELOPMENT,\r\n\tPRODUCTION\r\n};\r\n\r\nexport class Environment {\r\n\r\n\tget STATIC() {\r\n\t\treturn ENV.STATIC;\r\n\t}\r\n\tset STATIC(STATIC) {\r\n\t\tENV.STATIC = (STATIC === true || STATIC === 'true');\r\n\t\t// console.log('Environment.STATIC.set', ENV.STATIC);\r\n\t}\r\n\r\n\tget href() {\r\n\t\tif (HEROKU) {\r\n\t\t\treturn this.githubDocs;\r\n\t\t} else {\r\n\t\t\treturn BASE_HREF;\r\n\t\t}\r\n\t}\r\n\r\n\tgetAbsoluteUrl(path, params) {\r\n\t\tlet url = `${window.location.origin}${path}`;\r\n\t\t// let url = `${window.location.protocol}//${window.location.host}${path}`;\r\n\t\tObject.keys(params).forEach(key => {\r\n\t\t\turl = url.replace(`$${key}`, params[key]);\r\n\t\t});\r\n\t\treturn url;\r\n\t}\r\n\r\n\tgetPath(path) {\r\n\t\treturn this.isLocal(path) ? (this.href + path) : path;\r\n\t}\r\n\r\n\tisLocal(path) {\r\n\t\treturn path.indexOf('://') === -1;\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tif (options) {\r\n\t\t\tif (typeof options.url === 'object') {\r\n\t\t\t\tconst language = options.language || '';\r\n\t\t\t\tconst market = options.market || '';\r\n\t\t\t\tObject.keys(options.url).forEach(key => {\r\n\t\t\t\t\toptions.url[key] = language + market + options.url[key];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tObject.assign(this, options);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst defaultOptions = {\r\n\tport: 5000,\r\n\tfontFamily: 'GT Walsheim, sans-serif',\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\teditor: {\r\n\t\tdisabledViewTypes: ['waiting-room', 'room-3d'],\r\n\t\tdisabledViewItemTypes: ['texture'],\r\n\t},\r\n\trenderOrder: {\r\n\t\tpanorama: 0,\r\n\t\tmodel: 10,\r\n\t\tplane: 20,\r\n\t\ttile: 30,\r\n\t\tbanner: 40,\r\n\t\tnav: 50,\r\n\t\tpanel: 60,\r\n\t\tmenu: 70,\r\n\t\tdebug: 80,\r\n\t\tpointer: 90,\r\n\t}\r\n};\r\n\r\nconst defaultAppOptions = {\r\n\tchannelName: 'BHere',\r\n\tflags: {\r\n\t\tproduction: false,\r\n\t\tuseProxy: false,\r\n\t\tuseToken: false,\r\n\t\tselfService: true,\r\n\t\tguidedTourRequest: true,\r\n\t\teditor: true,\r\n\t\tar: true,\r\n\t\tmenu: true,\r\n\t\tattendee: true,\r\n\t\tstreamer: true,\r\n\t\tviewer: true,\r\n\t\tsmartDevice: true,\r\n\t\tmaxQuality: false,\r\n\t\theroku: HEROKU,\r\n\t},\r\n};\r\n\r\nconst environmentOptions = window.STATIC ? environmentStatic : environmentServed;\r\n\r\nlet options = Object.assign(defaultOptions, defaultAppOptions, environmentOptions);\r\noptions = Utils.merge(options, window.bhere);\r\n\r\nexport const environment = new Environment(options);\r\n\r\nconsole.log('environment', environment);\r\n","\r\nexport const environmentStatic = {\r\n\tflags: {\r\n\t\tproduction: false,\r\n\t},\r\n\tlogo: null,\r\n\tbackground: {\r\n\t\timage: '/terranova/img/background.jpg',\r\n\t\tvideo: '/terranova/img/background.mp4',\r\n\t},\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\tassets: '/terranova/',\r\n\tworker: './js/workers/image.service.worker.js',\r\n\tgithubDocs: 'https://raw.githubusercontent.com/actarian/terranova/main/docs/',\r\n\turl: {\r\n\t\tindex: '/',\r\n\t},\r\n\tlanguages: ['en'],\r\n\tdefaultLanguage: 'en',\r\n};\r\n","import { Pipe } from \"rxcomp\";\r\nimport { environment } from \"../environment\";\r\n\r\nexport default class FlagPipe extends Pipe {\r\n\r\n\tstatic transform(key) {\r\n\t\tconst flags = environment.flags;\r\n\t\treturn flags[key] || false;\r\n\t}\r\n\r\n}\r\n\r\nFlagPipe.meta = {\r\n\tname: 'flag',\r\n};\r\n","import { Component, getContext } from 'rxcomp';\r\n\r\nexport default class WebRTCStreamComponent extends Component {\r\n\r\n\tonChanges() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tconst video = node.querySelector('video');\r\n\t\tif (video.srcObject !== this.stream) {\r\n\t\t\tvideo.srcObject = this.stream;\r\n\t\t\t// console.log('WebRTCStreamComponent', video, this.stream);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nWebRTCStreamComponent.meta = {\r\n\tselector: '[webrtc-stream]',\r\n\tinputs: ['stream'],\r\n\ttemplate: /* html */ `\r\n\t\t<div class=\"webrtc-stream\">\r\n\t\t\t<video playsinline autoplay muted></video>\r\n\t\t</div>\r\n\t`\r\n};\r\n","import { CoreModule, Module } from 'rxcomp';\r\nimport AppComponent from './app.component';\r\nimport FlagPipe from './flag/flag.pipe';\r\nimport WebRTCStreamComponent from './webrtc/webrtc-stream.component';\r\n\r\nexport class AppModule extends Module { }\r\n\r\nAppModule.meta = {\r\n\timports: [\r\n\t\tCoreModule,\r\n\t],\r\n\tdeclarations: [\r\n\t\tFlagPipe,\r\n\t\tWebRTCStreamComponent,\r\n\t],\r\n\tbootstrap: AppComponent,\r\n};\r\n","import { Browser } from 'rxcomp';\r\nimport { AppModule } from './app.module';\r\n\r\nBrowser.bootstrap(AppModule);\r\n"]}