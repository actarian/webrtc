{"version":3,"sources":["src/js/main.js","../../src/js/webrtc/signaling.service.js","../../src/js/webrtc/user-media.service.js","../../src/js/webrtc/webrtc-client.service.js","../../src/js/webrtc/websocket.service.js","../../src/js/app.component.js","../../src/js/environment.served.js","../../src/js/utils/utils.js","../../src/js/environment.js","../../src/js/environment.static.js","../../src/js/flag/flag.pipe.js","../../src/js/webrtc/webrtc-stream.component.js","../../src/js/app.module.js","../../src/js/main.js"],"names":["g","f","exports","module","require","define","amd","globalThis","self","rxcomp","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_defineProperty","obj","value","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","SignalingService","in","message","in$","next","out","out$","send","sendBack","assign","clientId","remoteId","broadcast","ReplaySubject","UserMediaService","getUserMedia","Promise","resolve","reject","navigator","mediaDevices","audio","video","width","min","ideal","max","height","then","stream","console","log","audioTracks","getAudioTracks","label","videoTracks","getVideoTracks","catch","error","OFFER_OPTIONS","offerToReceiveAudio","offerToReceiveVideo","WebRTCClient","uid","_this","BehaviorSubject","getUniqueUserId","MediaStream","onIceCandidate","bind","onIceConnectionStateChange","onIceGatheringStateChange","onSignalingStateChange","onNegotiationceNeeded","onTrack","connection","RTCPeerConnection","getTracks","forEach","track","addTrack","addEventListener","pipe","tap","event","filter","subscribe","type","onMessageCandidate","onMessageAnswer","_proto","dispose","remote$","removeEventListener","close","candidate","iceConnectionState","iceGatheringState","signalingState","_this2","createOffer","offer","setLocalDescription","_","description","localDescription","x","onCreateOfferReject","streams","remote","sendOffer","_this3","addIceCandidate","onAddIceCandidateReject","onMessageOffer","_this4","RTCSessionDescription","setRemoteDescription","createAnswer","answer","onCreateAnswerReject","all","toString","call","Math","floor","random","Date","now","WebRTCClientService","addPeer","peerId","peers","peers$","getValue","slice","reduce","c","client","push","switchRemotes","addPeers","peerIds","removePeer","index","splice","remotes","map","remotes$","combineLatest","of","switchAll","WebSocketService","connect","onMessageCallback","onOpen","onClose","onMessage","host","location","origin","replace","socket","WebSocket","disconnect","message$","JSON","parse","data","response","backMessage","timeStamp","stringify","sendAll","AppComponent","_Component","apply","arguments","onInit","getContext","node","classList","remove","local","onSocketConnected","onJoined","onPeers","onPeerJoined","onPeerLeaved","onOffer","takeUntil","unsubscribe$","pushChanges","onJoin","info","firstName","lastName","remotePeers","indexOf","onCall","get","Component","meta","selector","Utils","merge","source","keys","Array","isArray","NODE","BASE_HREF","URLSearchParams","window","search","document","querySelector","getAttribute","HEROKU","STATIC","port","DEVELOPMENT","split","ENV","PRODUCTION","Environment","options","url","language","market","getAbsoluteUrl","path","params","getPath","isLocal","href","set","githubDocs","defaultAppOptions","channelName","flags","production","useProxy","useToken","selfService","guidedTourRequest","editor","ar","menu","attendee","streamer","viewer","smartDevice","maxQuality","heroku","environmentOptions","logo","background","image","colors","menuBackground","menuForeground","menuOverBackground","menuOverForeground","menuBackBackground","menuBackForeground","menuBackOverBackground","menuBackOverForeground","assets","worker","languages","defaultLanguage","fontFamily","disabledViewTypes","disabledViewItemTypes","renderOrder","panorama","model","plane","tile","banner","nav","panel","debug","pointer","environment","bhere","FlagPipe","_Pipe","transform","Pipe","name","WebRTCStreamComponent","onChanges","srcObject","inputs","template","AppModule","_Module","Module","imports","CoreModule","declarations","bootstrap","Browser"],"mappings":"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","file":"docs\\js\\main.min.js","sourcesContent":[null,"import { ReplaySubject } from 'rxjs';\r\n\r\nexport class SignalingService {\r\n\r\n\tstatic in$ = new ReplaySubject(1);\r\n\tstatic in(message) {\r\n\t\tSignalingService.in$.next(message);\r\n\t}\r\n\r\n\tstatic out$ = new ReplaySubject(1);\r\n\tstatic out(message) {\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic send(message) {\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic sendBack(message) {\r\n\t\tmessage = Object.assign({}, message, { clientId: message.remoteId, remoteId: message.clientId });\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\tstatic broadcast(message) {\r\n\t\tmessage.broadcast = true;\r\n\t\tSignalingService.out$.next(message);\r\n\t}\r\n\r\n}\r\n","\r\nexport class UserMediaService {\r\n\r\n\tstatic stream = null;\r\n\r\n\tstatic getUserMedia() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options = {\r\n\t\t\t\taudio: true,\r\n\t\t\t\tvideo: {\r\n\t\t\t\t\twidth: { min: 320, ideal: 640, max: 640 },\r\n\t\t\t\t\theight: { min: 240, ideal: 480, max: 480 }\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tnavigator.mediaDevices.getUserMedia(options).then((stream) => {\r\n\t\t\t\tconsole.log('UserMediaService.getUserMedia', stream);\r\n\t\t\t\tUserMediaService.stream = stream;\r\n\t\t\t\t//\r\n\t\t\t\tconst audioTracks = stream.getAudioTracks();\r\n\t\t\t\tif (audioTracks.length > 0) {\r\n\t\t\t\t\tconsole.log('UserMediaService.audioTracks', audioTracks[0].label);\r\n\t\t\t\t}\r\n\t\t\t\tconst videoTracks = stream.getVideoTracks();\r\n\t\t\t\tif (videoTracks.length > 0) {\r\n\t\t\t\t\tconsole.log('UserMediaService.videoTracks', videoTracks[0].label);\r\n\t\t\t\t}\r\n\t\t\t\t//\r\n\t\t\t\tresolve(stream);\r\n\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tconsole.log('UserMediaService.getUserMedia.error', error);\r\n\t\t\t\treject(error);\r\n\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n}\r\n","import { BehaviorSubject, combineLatest, of, ReplaySubject } from \"rxjs\";\r\nimport { filter, switchAll, tap } from \"rxjs/operators\";\r\nimport { SignalingService } from \"./signaling.service\";\r\n\r\nconst SERVERS = null;\r\n\r\nconst OFFER_OPTIONS = {\r\n\tofferToReceiveAudio: true,\r\n\tofferToReceiveVideo: true\r\n};\r\n\r\nconst state = {\r\n\tlocal: null,\r\n};\r\n\r\nexport class WebRTCClient {\r\n\r\n\tremote$ = new BehaviorSubject(null);\r\n\r\n\tconstructor(stream, uid = null, remoteId = null) {\r\n\t\tthis.uid = uid || WebRTCClient.getUniqueUserId();\r\n\t\tthis.remoteId = remoteId;\r\n\t\tthis.stream = stream || new MediaStream();\r\n\t\tthis.onIceCandidate = this.onIceCandidate.bind(this);\r\n\t\tthis.onIceConnectionStateChange = this.onIceConnectionStateChange.bind(this);\r\n\t\tthis.onIceGatheringStateChange = this.onIceGatheringStateChange.bind(this);\r\n\t\tthis.onSignalingStateChange = this.onSignalingStateChange.bind(this);\r\n\t\tthis.onNegotiationceNeeded = this.onNegotiationceNeeded.bind(this);\r\n\t\tthis.onTrack = this.onTrack.bind(this);\r\n\t\t// Create an RTCPeerConnection via the polyfill.\r\n\t\tconst connection = this.connection = new RTCPeerConnection(SERVERS);\r\n\t\tif (stream) {\r\n\t\t\tstream.getTracks().forEach(track => connection.addTrack(track, stream));\r\n\t\t}\r\n\t\tconnection.addEventListener('icecandidate', this.onIceCandidate);\r\n\t\tconnection.addEventListener('iceconnectionstatechange', this.onIceConnectionStateChange);\r\n\t\tconnection.addEventListener('icegatheringstatechange', this.onIceGatheringStateChange);\r\n\t\tconnection.addEventListener('signalingstatechange', this.onSignalingStateChange);\r\n\t\tconnection.addEventListener('negotiationneeded', this.onNegotiationceNeeded);\r\n\t\tconnection.addEventListener('track', this.onTrack);\r\n\t\tSignalingService.in$.pipe(\r\n\t\t\ttap(event => console.log(event)),\r\n\t\t\tfilter(event => event.uid !== this.uid),\r\n\t\t).subscribe(message => {\r\n\t\t\tconsole.log('WebRTCClient.message', message);\r\n\t\t\tswitch (message.type) {\r\n\t\t\t\tcase 'candidate':\r\n\t\t\t\t\tthis.onMessageCandidate(message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t/*\r\n\t\t\tcase 'offer':\r\n\t\t\t\tthis.onMessageOffer(message);\r\n\t\t\t\tbreak;\r\n\t\t\t\t*/\r\n\t\t\t\tcase 'answer':\r\n\t\t\t\t\tthis.onMessageAnswer(message);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// this.sendOffer();\r\n\t}\r\n\r\n\tdispose() {\r\n\t\tthis.remote$.next(null);\r\n\r\n\t\tconst connection = this.connection;\r\n\t\tconnection.removeEventListener('icecandidate', this.onIceCandidate);\r\n\t\tconnection.removeEventListener('iceconnectionstatechange', this.onIceConnectionStateChange);\r\n\t\tconnection.removeEventListener('icegatheringstatechange', this.onIceGatheringStateChange);\r\n\t\tconnection.removeEventListener('signalingstatechange', this.onSignalingStateChange);\r\n\t\tconnection.removeEventListener('negotiationneeded', this.onNegotiationceNeeded);\r\n\t\tconnection.removeEventListener('track', this.onTrack);\r\n\t\t/*\r\n\t\tconnection.getTracks().forEach(track => {\r\n\t\t\ttrack.stop();\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\tconnection.getTransceivers().forEach(transceiver => {\r\n\t\t\ttransceiver.stop();\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\t/*\r\n\t\tif (localVideo.srcObject) {\r\n\t\t\tlocalVideo.pause();\r\n\t\t\tlocalVideo.srcObject.getTracks().forEach(track => {\r\n\t\t\t\ttrack.stop();\r\n\t\t\t});\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// Close the peer connection\r\n\r\n\t\tconnection.close();\r\n\t\tthis.connection = null;\r\n\t\t// webcamStream = null;\r\n\t}\r\n\r\n\tonIceCandidate(event) {\r\n\t\tconsole.log('WebRTCClient.onIceCandidate', event);\r\n\t\tconst candidate = event.candidate;\r\n\t\tif (candidate) {\r\n\t\t\tSignalingService.send({ type: 'candidate', candidate, uid: this.uid, remoteId: this.remoteId });\r\n\t\t}\r\n\t}\r\n\r\n\tonIceConnectionStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onIceConnectionStateChange', event);\r\n\t\tswitch (this.iceConnectionState) {\r\n\t\t\tcase 'closed':\r\n\t\t\tcase 'failed':\r\n\t\t\tcase 'disconnected':\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tonIceGatheringStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onIceGatheringStateChange', this.connection.iceGatheringState);\r\n\t}\r\n\r\n\tonSignalingStateChange(event) {\r\n\t\tconsole.log('WebRTCClient.onSignalingStateChange', this.connection.signalingState);\r\n\t\tswitch (this.connection.signalingState) {\r\n\t\t\tcase 'closed':\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tonNegotiationceNeeded(event) {\r\n\t\tconsole.log('WebRTCClient.onNegotiationceNeeded', event);\r\n\t\tthis.connection.createOffer(OFFER_OPTIONS).then((offer) => {\r\n\t\t\t/*\r\n\t\t\tif (this.connection.signalingState != 'stable') {\r\n\t\t\t\tconsole.log('WebRTCClient.onNegotiationceNeeded', 'The connection isn\\'t stable yet; postponing...');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tthis.connection.setLocalDescription(offer).then(_ => {\r\n\t\t\t\tSignalingService.send({ type: 'offer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t});\r\n\t\t}, (x) => this.onCreateOfferReject(x));\r\n\t}\r\n\r\n\tonTrack(event) {\r\n\t\tconsole.log('WebRTCClient.onTrack', event.streams);\r\n\t\tconst remote = event.streams[0];\r\n\t\tthis.remote$.next(remote);\r\n\t}\r\n\r\n\tsendOffer() {\r\n\t\tthis.connection.createOffer(OFFER_OPTIONS).then((offer) => {\r\n\t\t\tthis.connection.setLocalDescription(offer).then(_ => {\r\n\t\t\t\tSignalingService.send({ type: 'offer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t});\r\n\t\t}, (x) => this.onCreateOfferReject(x));\r\n\t}\r\n\r\n\tonMessageCandidate(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log('WebRTCClient.onMessageCandidate', 'uid', message.uid);\r\n\t\tthis.connection.addIceCandidate(message.candidate).then(() => {\r\n\t\t\tconsole.log('WebRTCService.onAddIceCandidateResolve');\r\n\t\t}, this.onAddIceCandidateReject);\r\n\t}\r\n\r\n\tonMessageOffer(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log('WebRTCClient.onMessageOffer', 'uid', message.uid);\r\n\t\tconst description = new RTCSessionDescription(message.description);\r\n\t\tconst onAnswer = () => {\r\n\t\t\tthis.connection.createAnswer().then((answer) => {\r\n\t\t\t\tthis.connection.setLocalDescription(answer).then(_ => {\r\n\t\t\t\t\tSignalingService.send({ type: 'answer', description: this.connection.localDescription, uid: this.uid, remoteId: this.remoteId });\r\n\t\t\t\t});\r\n\t\t\t}, (x) => this.onCreateAnswerReject(x));\r\n\t\t}\r\n\t\tif (this.connection.signalingState != 'stable') {\r\n\t\t\tPromise.all([\r\n\t\t\t\tthis.connection.setLocalDescription({ type: \"rollback\" }),\r\n\t\t\t\tthis.connection.setRemoteDescription(description),\r\n\t\t\t]);\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tthis.connection.setRemoteDescription(description).then(_ => {\r\n\t\t\t\tonAnswer();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tonMessageAnswer(message) {\r\n\t\tif (message.uid !== this.remoteId) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconsole.log('WebRTCClient.onMessageAnswer', 'uid', message.uid);\r\n\t\t// Since the 'remote' side has no media stream we need\r\n\t\t// to pass in the right constraints in order for it to\r\n\t\t// accept the incoming offer of audio and video.\r\n\t\tthis.connection.setRemoteDescription(new RTCSessionDescription(message.description));\r\n\t}\r\n\r\n\tonAddIceCandidateReject(error) {\r\n\t\tconsole.log('WebRTCClient.onAddIceCandidateReject', error.toString());\r\n\t}\r\n\r\n\tonCreateOfferReject(error) {\r\n\t\tconsole.log('WebRTCClient.onCreateOfferReject', error.toString());\r\n\t}\r\n\r\n\tonCreateAnswerReject(error) {\r\n\t\tconsole.log('WebRTCClient.onCreateAnswerReject', error.toString());\r\n\t}\r\n\r\n\tstatic call(stream, uid = null, remoteId = null) {\r\n\t\tconsole.log('WebRTCClient.call', remoteId);\r\n\t\tconst client = new WebRTCClient(stream, uid, remoteId);\r\n\t\treturn client;\r\n\t}\r\n\r\n\tstatic answer(stream, uid = null, remoteId = null) {\r\n\t\tconsole.log('WebRTCClient.answer', remoteId);\r\n\t\tconst client = new WebRTCClient(stream, uid, remoteId);\r\n\t\treturn client;\r\n\t}\r\n\r\n\tstatic getUniqueUserId() {\r\n\t\t// max safe integer 9007199254740991 length 16\r\n\t\t// max allowed integer 4294967296 2^32\r\n\t\tconst m = 9007199254740991;\r\n\t\tconst mult = 10000000000000;\r\n\t\tconst a = (1 + Math.floor(Math.random() * 8)) * 100;\r\n\t\tconst b = (1 + Math.floor(Math.random() * 8)) * 10;\r\n\t\tconst c = (1 + Math.floor(Math.random() * 8)) * 1;\r\n\t\tconst combo = (a + b + c);\r\n\t\tconst date = Date.now();\r\n\t\tconst uid = combo * mult + date;\r\n\t\t// console.log(combo);\r\n\t\t// console.log(date);\r\n\t\t// console.log(m);\r\n\t\t// console.log('AgoraService.getUniqueUserId', uid);\r\n\t\treturn uid.toString();\r\n\t\t// return Math.floor(Math.random() * 100000) + '-' + new Date().getTime();\r\n\t}\r\n}\r\n\r\nexport class WebRTCClientService {\r\n\r\n\tstatic remotes$ = new ReplaySubject().pipe(\r\n\t\tswitchAll(),\r\n\t);\r\n\tstatic peers$ = new BehaviorSubject([]);\r\n\r\n\tstatic addPeer(stream, uid, peerId) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst index = peers.reduce((p, c, i) => {\r\n\t\t\treturn c.remoteId === peerId ? i : p;\r\n\t\t}, -1);\r\n\t\tif (index !== -1) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tconst client = new WebRTCClient(stream, uid, peerId);\r\n\t\t\tpeers.push(client);\r\n\t\t\tthis.peers$.next(peers);\r\n\t\t\tthis.switchRemotes();\r\n\t\t\treturn client;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic addPeers(stream, uid, peerIds) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tpeerIds.forEach(peerId => {\r\n\t\t\tconst client = new WebRTCClient(stream, uid, peerId);\r\n\t\t\tpeers.push(client);\r\n\t\t})\r\n\t\tthis.peers$.next(peers);\r\n\t\tthis.switchRemotes();\r\n\t}\r\n\r\n\tstatic removePeer(peerId) {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst index = peers.reduce((p, c, i) => {\r\n\t\t\treturn c.remoteId === peerId ? i : p;\r\n\t\t}, -1);\r\n\t\tif (index !== -1) {\r\n\t\t\tconst client = peers[index];\r\n\t\t\tclient.dispose();\r\n\t\t\tpeers.splice(index, 1);\r\n\t\t\tthis.peers$.next(peers);\r\n\t\t\tthis.switchRemotes();\r\n\t\t}\r\n\t}\r\n\r\n\tstatic switchRemotes() {\r\n\t\tconst peers = this.peers$.getValue().slice();\r\n\t\tconst remotes = peers.map(client => client.remote$);\r\n\t\tconst remotes$ = remotes.length ? combineLatest(remotes) : of([]);\r\n\t\tWebRTCClientService.remotes$.next(remotes$);\r\n\t}\r\n\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\n\r\nexport class WebSocketService {\r\n\r\n\tstatic message$ = new ReplaySubject(1);\r\n\r\n\tstatic connect(uid = null, onMessageCallback = null) {\r\n\t\tuid = uid || this.getUniqueUserId();\r\n\t\tthis.uid = uid;\r\n\t\tthis.onMessageCallback = onMessageCallback;\r\n\t\tthis.onOpen = this.onOpen.bind(this);\r\n\t\tthis.onClose = this.onClose.bind(this);\r\n\t\tthis.onMessage = this.onMessage.bind(this);\r\n\t\tconst host = location.origin.replace(/^https/, 'wss').replace(/^http/, 'ws');\r\n\t\tconst socket = this.socket = new WebSocket(host);\r\n\t\tsocket.addEventListener('open', this.onOpen);\r\n\t\tsocket.addEventListener('close', this.onClose);\r\n\t\tsocket.addEventListener('message', this.onMessage);\r\n\t}\r\n\r\n\tstatic disconnect() {\r\n\t\tconst socket = this.socket;\r\n\t\tif (socket) {\r\n\t\t\tsocket.close();\r\n\t\t\tthis.socket = null;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onOpen(event) {\r\n\t\t// console.log('WebSocketService.onOpen');\r\n\t\tconst message = { type: 'socketConnected' };\r\n\t\tthis.message$.next(message);\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onClose(event) {\r\n\t\t// console.log('WebSocketService.onClose');const message = { type: 'socketConnected' };\r\n\t\tconst message = { type: 'socketDisconnected' };\r\n\t\tthis.message$.next(message);\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onMessage(event) {\r\n\t\tconst message = JSON.parse(event.data);\r\n\t\t// console.log('WebSocketService.onMessage', message);\r\n\t\tif (message.remoteId) {\r\n\t\t\tmessage.sendBack = (response = {}) => {\r\n\t\t\t\tconst backMessage = Object.assign({}, message, response, { uid: message.remoteId, remoteId: message.uid });\r\n\t\t\t\tWebSocketService.send(backMessage);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (typeof this.onMessageCallback === 'function') {\r\n\t\t\tthis.onMessageCallback(message);\r\n\t\t}\r\n\t\tthis.message$.next(message);\r\n\t}\r\n\r\n\tstatic send(message = {}, broadcast) {\r\n\t\tconst socket = WebSocketService.socket;\r\n\t\tmessage.uid = this.uid;\r\n\t\tmessage.timeStamp = Date.now();\r\n\t\tif (broadcast) {\r\n\t\t\tmessage.broadcast = true;\r\n\t\t}\r\n\t\t// console.log('WebSocketService.send', message);\r\n\t\tsocket.send(JSON.stringify(message));\r\n\t}\r\n\r\n\tstatic sendAll(message = {}) {\r\n\t\tWebSocketService.send(message, true);\r\n\t}\r\n\r\n\tstatic getUniqueUserId() {\r\n\t\t// max safe integer 9007199254740991 length 16\r\n\t\t// max allowed integer 4294967296 2^32\r\n\t\tconst m = 9007199254740991;\r\n\t\tconst mult = 10000000000000;\r\n\t\tconst a = (1 + Math.floor(Math.random() * 8)) * 100;\r\n\t\tconst b = (1 + Math.floor(Math.random() * 8)) * 10;\r\n\t\tconst c = (1 + Math.floor(Math.random() * 8)) * 1;\r\n\t\tconst combo = (a + b + c);\r\n\t\tconst date = Date.now();\r\n\t\tconst uid = combo * mult + date;\r\n\t\t// console.log(combo);\r\n\t\t// console.log(date);\r\n\t\t// console.log(m);\r\n\t\t// console.log('AgoraService.getUniqueUserId', uid);\r\n\t\treturn uid.toString();\r\n\t}\r\n\r\n}\r\n","import { Component, getContext } from 'rxcomp';\r\nimport { filter, takeUntil, tap } from 'rxjs/operators';\r\nimport { SignalingService } from './webrtc/signaling.service';\r\nimport { UserMediaService } from './webrtc/user-media.service';\r\nimport { WebRTCClientService } from './webrtc/webrtc-client.service';\r\nimport { WebSocketService } from './webrtc/websocket.service';\r\n\r\nexport default class AppComponent extends Component {\r\n\r\n\tget remotePeers() {\r\n\t\treturn (this.peers || []).filter(x => x !== this.uid);\r\n\t}\r\n\r\n\tonInit() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tnode.classList.remove('hidden');\r\n\t\tconsole.log('AppComponent');\r\n\r\n\t\tthis.local = null;\r\n\t\tthis.uid = null;\r\n\t\tthis.peers = [];\r\n\t\tthis.remotes = [];\r\n\t\tthis.streams = [];\r\n\r\n\t\tSignalingService.in$.pipe(\r\n\t\t\ttap(message => {\r\n\t\t\t\tconsole.log('AppComponent.SignalingService.in$', message);\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tcase 'socketConnected':\r\n\t\t\t\t\t\tthis.onSocketConnected();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'joined':\r\n\t\t\t\t\t\tthis.onJoined(message.peerId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'leaved':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peers':\r\n\t\t\t\t\t\tthis.onPeers(message.peers);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerJoined':\r\n\t\t\t\t\t\tif (message.peerId !== this.uid) {\r\n\t\t\t\t\t\t\tthis.onPeerJoined(message.peerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerLeaved':\r\n\t\t\t\t\t\tif (message.peerId !== this.uid) {\r\n\t\t\t\t\t\t\tthis.onPeerLeaved(message.peerId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerInfo':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'peerInfos':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'offer':\r\n\t\t\t\t\t\tthis.onOffer(message);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t).subscribe();\r\n\r\n\t\t// rewire messages to socket service\r\n\t\tSignalingService.out$.pipe(\r\n\t\t\tfilter(message => {\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttap(message => WebSocketService.send(message)),\r\n\t\t).subscribe();\r\n\r\n\t\tWebRTCClientService.remotes$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(remotes => {\r\n\t\t\tconsole.log('AppComponent.remotes', remotes);\r\n\t\t\tthis.remotes = remotes;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonJoin(event) {\r\n\t\tif (this.uid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tUserMediaService.getUserMedia().then(stream => {\r\n\t\t\tthis.local = stream;\r\n\t\t\tthis.pushChanges();\r\n\t\t\tWebSocketService.connect(null, (message) => SignalingService.in(message));\r\n\t\t});\r\n\t}\r\n\r\n\tonSocketConnected() {\r\n\t\tSignalingService.out({ type: 'join', uid: WebSocketService.uid, info: { firstName: 'Jhon', lastName: 'Appleseed' } });\r\n\t}\r\n\r\n\tonJoined(uid) {\r\n\t\tthis.uid = WebSocketService.uid = uid;\r\n\t\tthis.pushChanges();\r\n\t\tWebSocketService.send({ type: 'peers', uid: WebSocketService.uid });\r\n\t}\r\n\r\n\tonPeers(peers) {\r\n\t\tthis.peers = peers;\r\n\t\tWebRTCClientService.addPeers(this.local, this.uid, this.remotePeers);\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonPeerJoined(peerId) {\r\n\t\tconst index = this.peers.indexOf(peerId);\r\n\t\tif (index === -1) {\r\n\t\t\tthis.peers.push(peerId);\r\n\t\t\tthis.pushChanges();\r\n\t\t}\r\n\t}\r\n\r\n\tonPeerLeaved(peerId) {\r\n\t\tconst index = this.peers.indexOf(peerId);\r\n\t\tif (index !== -1) {\r\n\t\t\tthis.peers.splice(index, 1);\r\n\t\t\tthis.pushChanges();\r\n\t\t}\r\n\t\tWebRTCClientService.removePeer(peerId);\r\n\t}\r\n\r\n\tonCall(peerId) {\r\n\t\treturn;\r\n\t\t/*\r\n\t\tconsole.log('AppComponent.onCall', peerId);\r\n\t\tconst client = this.client = WebRTCClient.call(this.local, this.uid, peerId);\r\n\t\tclient.streams$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$),\r\n\t\t).subscribe(streams => {\r\n\t\t\tthis.streams = streams;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t\t*/\r\n\t}\r\n\r\n\tonOffer(message) {\r\n\t\tconsole.log('AppComponent.onOffer', message);\r\n\t\tconst client = WebRTCClientService.addPeer(this.local, this.uid, message.uid);\r\n\t\tif (client != null) {\r\n\t\t\tclient.onMessageOffer(message);\r\n\t\t}\r\n\t\t/*\r\n\t\tif (this.client) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst client = this.client = WebRTCClient.answer(this.local, this.uid, message.uid);\r\n\t\tclient.onMessageOffer(message);\r\n\t\tclient.streams$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$),\r\n\t\t).subscribe(streams => {\r\n\t\t\tthis.streams = streams;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t\t*/\r\n\t}\r\n\r\n}\r\n\r\nAppComponent.meta = {\r\n\tselector: '[app-component]',\r\n};\r\n","\r\nexport const environmentServed = {\r\n\tflags: {\r\n\t\tproduction: true,\r\n\t},\r\n\tlogo: null,\r\n\tbackground: {\r\n\t\timage: '/Client/docs/img/background.jpg',\r\n\t\tvideo: '/Client/docs/img/background.mp4',\r\n\t},\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\tassets: '/Client/docs/',\r\n\tworker: '/Client/docs/js/workers/image.service.worker.js',\r\n\tgithubDocs: 'https://raw.githubusercontent.com/actarian/terranova/main/docs/',\r\n\turl: {\r\n\t\tindex: '/',\r\n\t},\r\n\tlanguages: ['en'],\r\n\tdefaultLanguage: 'en',\r\n};\r\n","\r\nexport class Utils {\r\n\r\n\tstatic merge(target, source) {\r\n\t\tif (typeof source === 'object') {\r\n\t\t\tObject.keys(source).forEach(key => {\r\n\t\t\t\tconst value = source[key];\r\n\t\t\t\tif (typeof value === 'object' && !Array.isArray(value)) {\r\n\t\t\t\t\ttarget[key] = this.merge(target[key], value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[key] = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn target;\r\n\t}\r\n\r\n}\r\n","import { environmentServed } from './environment.served';\r\nimport { environmentStatic } from './environment.static';\r\nimport { Utils } from './utils/utils';\r\n\r\nexport const NODE = (typeof module !== 'undefined' && module.exports);\r\nexport const PARAMS = NODE ? { get: () => { } } : new URLSearchParams(window.location.search);\r\nexport const DEBUG = false || (PARAMS.get('debug') != null);\r\nexport const BASE_HREF = NODE ? null : document.querySelector('base').getAttribute('href');\r\nexport const HEROKU = NODE ? false : (window && window.location.host.indexOf('herokuapp') !== -1);\r\nexport const STATIC = NODE ? false : (HEROKU || (window && (window.location.port === '41789' || window.location.port === '5000' || window.location.port === '6443' || window.location.host === 'actarian.github.io')));\r\nexport const DEVELOPMENT = NODE ? false : (window && ['localhost', '127.0.0.1', '0.0.0.0'].indexOf(window.location.host.split(':')[0]) !== -1);\r\nexport const PRODUCTION = !DEVELOPMENT;\r\nexport const ENV = {\r\n\tSTATIC,\r\n\tDEVELOPMENT,\r\n\tPRODUCTION\r\n};\r\n\r\nexport class Environment {\r\n\r\n\tget STATIC() {\r\n\t\treturn ENV.STATIC;\r\n\t}\r\n\tset STATIC(STATIC) {\r\n\t\tENV.STATIC = (STATIC === true || STATIC === 'true');\r\n\t\t// console.log('Environment.STATIC.set', ENV.STATIC);\r\n\t}\r\n\r\n\tget href() {\r\n\t\tif (HEROKU) {\r\n\t\t\treturn this.githubDocs;\r\n\t\t} else {\r\n\t\t\treturn BASE_HREF;\r\n\t\t}\r\n\t}\r\n\r\n\tgetAbsoluteUrl(path, params) {\r\n\t\tlet url = `${window.location.origin}${path}`;\r\n\t\t// let url = `${window.location.protocol}//${window.location.host}${path}`;\r\n\t\tObject.keys(params).forEach(key => {\r\n\t\t\turl = url.replace(`$${key}`, params[key]);\r\n\t\t});\r\n\t\treturn url;\r\n\t}\r\n\r\n\tgetPath(path) {\r\n\t\treturn this.isLocal(path) ? (this.href + path) : path;\r\n\t}\r\n\r\n\tisLocal(path) {\r\n\t\treturn path.indexOf('://') === -1;\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tif (options) {\r\n\t\t\tif (typeof options.url === 'object') {\r\n\t\t\t\tconst language = options.language || '';\r\n\t\t\t\tconst market = options.market || '';\r\n\t\t\t\tObject.keys(options.url).forEach(key => {\r\n\t\t\t\t\toptions.url[key] = language + market + options.url[key];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tObject.assign(this, options);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst defaultOptions = {\r\n\tport: 5000,\r\n\tfontFamily: 'GT Walsheim, sans-serif',\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\teditor: {\r\n\t\tdisabledViewTypes: ['waiting-room', 'room-3d'],\r\n\t\tdisabledViewItemTypes: ['texture'],\r\n\t},\r\n\trenderOrder: {\r\n\t\tpanorama: 0,\r\n\t\tmodel: 10,\r\n\t\tplane: 20,\r\n\t\ttile: 30,\r\n\t\tbanner: 40,\r\n\t\tnav: 50,\r\n\t\tpanel: 60,\r\n\t\tmenu: 70,\r\n\t\tdebug: 80,\r\n\t\tpointer: 90,\r\n\t}\r\n};\r\n\r\nconst defaultAppOptions = {\r\n\tchannelName: 'BHere',\r\n\tflags: {\r\n\t\tproduction: false,\r\n\t\tuseProxy: false,\r\n\t\tuseToken: false,\r\n\t\tselfService: true,\r\n\t\tguidedTourRequest: true,\r\n\t\teditor: true,\r\n\t\tar: true,\r\n\t\tmenu: true,\r\n\t\tattendee: true,\r\n\t\tstreamer: true,\r\n\t\tviewer: true,\r\n\t\tsmartDevice: true,\r\n\t\tmaxQuality: false,\r\n\t\theroku: HEROKU,\r\n\t},\r\n};\r\n\r\nconst environmentOptions = window.STATIC ? environmentStatic : environmentServed;\r\n\r\nlet options = Object.assign(defaultOptions, defaultAppOptions, environmentOptions);\r\noptions = Utils.merge(options, window.bhere);\r\n\r\nexport const environment = new Environment(options);\r\n\r\nconsole.log('environment', environment);\r\n","\r\nexport const environmentStatic = {\r\n\tflags: {\r\n\t\tproduction: false,\r\n\t},\r\n\tlogo: null,\r\n\tbackground: {\r\n\t\timage: '/terranova/img/background.jpg',\r\n\t\tvideo: '/terranova/img/background.mp4',\r\n\t},\r\n\tcolors: {\r\n\t\tmenuBackground: '#000000',\r\n\t\tmenuForeground: '#ffffff',\r\n\t\tmenuOverBackground: '#0099ff',\r\n\t\tmenuOverForeground: '#ffffff',\r\n\t\tmenuBackBackground: '#0099ff',\r\n\t\tmenuBackForeground: '#000000',\r\n\t\tmenuBackOverBackground: '#0099ff',\r\n\t\tmenuBackOverForeground: '#ffffff',\r\n\t},\r\n\tassets: '/terranova/',\r\n\tworker: './js/workers/image.service.worker.js',\r\n\tgithubDocs: 'https://raw.githubusercontent.com/actarian/terranova/main/docs/',\r\n\turl: {\r\n\t\tindex: '/',\r\n\t},\r\n\tlanguages: ['en'],\r\n\tdefaultLanguage: 'en',\r\n};\r\n","import { Pipe } from \"rxcomp\";\r\nimport { environment } from \"../environment\";\r\n\r\nexport default class FlagPipe extends Pipe {\r\n\r\n\tstatic transform(key) {\r\n\t\tconst flags = environment.flags;\r\n\t\treturn flags[key] || false;\r\n\t}\r\n\r\n}\r\n\r\nFlagPipe.meta = {\r\n\tname: 'flag',\r\n};\r\n","import { Component, getContext } from 'rxcomp';\r\n\r\nexport default class WebRTCStreamComponent extends Component {\r\n\r\n\tonChanges() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tconst video = node.querySelector('video');\r\n\t\tif (video.srcObject !== this.stream) {\r\n\t\t\tvideo.srcObject = this.stream;\r\n\t\t\tconsole.log('WebRTCStreamComponent', video, this.stream);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nWebRTCStreamComponent.meta = {\r\n\tselector: '[webrtc-stream]',\r\n\tinputs: ['stream'],\r\n\ttemplate: /* html */ `\r\n\t\t<div class=\"webrtc-stream\">\r\n\t\t\t<video playsinline autoplay muted></video>\r\n\t\t</div>\r\n\t`\r\n};\r\n","import { CoreModule, Module } from 'rxcomp';\r\nimport AppComponent from './app.component';\r\nimport FlagPipe from './flag/flag.pipe';\r\nimport WebRTCStreamComponent from './webrtc/webrtc-stream.component';\r\n\r\nexport class AppModule extends Module { }\r\n\r\nAppModule.meta = {\r\n\timports: [\r\n\t\tCoreModule,\r\n\t],\r\n\tdeclarations: [\r\n\t\tFlagPipe,\r\n\t\tWebRTCStreamComponent,\r\n\t],\r\n\tbootstrap: AppComponent,\r\n};\r\n","import { Browser } from 'rxcomp';\r\nimport { AppModule } from './app.module';\r\n\r\nBrowser.bootstrap(AppModule);\r\n"]}